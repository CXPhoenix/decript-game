/*! For license information please see project.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function o(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function s(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function c(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}Object.create,Object.create;var h={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e}(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var h=s<<4&240|a>>2;if(r.push(h),64!==u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function l(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=l(t[n],e[n]));return t}var f=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();function p(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}var y=function(t){function e(n,r,i){var o=t.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,v.prototype.create),o}return n(e,t),e}(Error),v=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?m(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new y(i,a,r);return u},t}();function m(t,e){return t.replace(g,(function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"}))}var g=/\{\$([^}]+)}/g;function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function w(t,e){var n=new I(t,e);return n.subscribe.bind(n)}!function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782),i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t}}();var I=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=E),void 0===r.error&&(r.error=E),void 0===r.complete&&(r.complete=E);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function E(){}function _(t){return t&&t._delegate?t._delegate:t}var T,S=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),A="[DEFAULT]",N=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Set}return t.prototype.get=function(t){void 0===t&&(t=A);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new f;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=i({identifier:A,optional:!1},t),n=e.identifier,r=e.optional,o=this.normalizeInstanceIdentifier(n);if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:A})}catch(t){}try{for(var r=a(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=u(i.value,2),s=o[0],c=o[1],h=this.normalizeInstanceIdentifier(s);try{var l=this.getOrInitializeService({instanceIdentifier:h});c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=A),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(c(c([],u(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))),u(t.filter((function(t){return"_delete"in t})).map((function(t){return t._delete()})))))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=A),this.instances.has(t)},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var r=t.instanceIdentifier,i=void 0===r?A:r,o=t.options,s=void 0===o?{}:o,c=this.normalizeInstanceIdentifier(i);if(this.isInitialized(c))throw Error(this.name+"("+c+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var h=this.getOrInitializeService({instanceIdentifier:c,options:s});try{for(var l=a(this.instancesDeferred.entries()),f=l.next();!f.done;f=l.next()){var p=u(f.value,2),d=p[0],y=p[1];c===this.normalizeInstanceIdentifier(d)&&y.resolve(h)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return this.invokeOnInitCallbacks(h,c),h},t.prototype.onInit=function(t){var e=this;return this.onInitCallbacks.add(t),function(){e.onInitCallbacks.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,e){var n,r;try{for(var i=a(this.onInitCallbacks),o=i.next();!o.done;o=i.next()){var s=o.value;try{s(t,e)}catch(t){}}}catch(t){n={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===A?void 0:e),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(t){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:A:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}(),D=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new N(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();function C(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var k,O=[];!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(k||(k={}));var R,x={debug:k.DEBUG,verbose:k.VERBOSE,info:k.INFO,warn:k.WARN,error:k.ERROR,silent:k.SILENT},L=k.INFO,P=((T={})[k.DEBUG]="log",T[k.VERBOSE]="log",T[k.INFO]="info",T[k.WARN]="warn",T[k.ERROR]="error",T),M=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=P[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,C(["["+i+"]  "+t.name+":"],n))}},F=function(){function t(t){this.name=t,this._logLevel=L,this._logHandler=M,this._userLogHandler=null,O.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in k))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?x[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.DEBUG],t)),this._logHandler.apply(this,C([this,k.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.VERBOSE],t)),this._logHandler.apply(this,C([this,k.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.INFO],t)),this._logHandler.apply(this,C([this,k.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.WARN],t)),this._logHandler.apply(this,C([this,k.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,C([this,k.ERROR],t)),this._logHandler.apply(this,C([this,k.ERROR],t))},t}();function V(t){O.forEach((function(e){e.setLogLevel(t)}))}var U,q=((R={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",R["bad-app-name"]="Illegal App name: '{$appName}",R["duplicate-app"]="Firebase App named '{$appName}' already exists",R["app-deleted"]="Firebase App named '{$appName}' already deleted",R["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",R["invalid-log-argument"]="First argument to `onLog` must be null or a function.",R),B=new v("app","Firebase",q),j="@firebase/app",K="[DEFAULT]",G=((U={})[j]="fire-core",U["@firebase/analytics"]="fire-analytics",U["@firebase/app-check"]="fire-app-check",U["@firebase/auth"]="fire-auth",U["@firebase/database"]="fire-rtdb",U["@firebase/functions"]="fire-fn",U["@firebase/installations"]="fire-iid",U["@firebase/messaging"]="fire-fcm",U["@firebase/performance"]="fire-perf",U["@firebase/remote-config"]="fire-rc",U["@firebase/storage"]="fire-gcs",U["@firebase/firestore"]="fire-fst",U["fire-js"]="fire-js",U["firebase-wrapper"]="fire-js-all",U),z=new F("@firebase/app"),H=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=l(void 0,t),this.container=new D(e.name),this._addComponent(new S("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(t){return r._addComponent(t)}))}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e=K),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=K),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){z.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw B.create("app-deleted",{appName:this.name_})},t}();H.prototype.name&&H.prototype.options||H.prototype.delete||console.log("dc");var Q=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=K);var s=o.name;if("string"!=typeof s||!s)throw B.create("bad-app-name",{appName:String(s)});if(b(e,s))throw B.create("duplicate-app",{appName:s});var a=new t(n,o,r);return e[s]=a,a},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=G[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){var u=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&a&&u.push("and"),a&&u.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void z.warn(u.join(" "))}o(new S(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:V,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw B.create("invalid-log-argument");!function(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=x[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:k[n].toLowerCase(),message:s,args:i,type:e.name})}},r=0,i=O;r<i.length;r++)n(i[r])}(t,e)},apps:null,SDK_VERSION:"8.5.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(!b(e,t=t||K))throw B.create("no-app",{appName:t});return e[t]}function o(o){var s=o.name;if(n.has(s))return z.debug("There were multiple attempts to register component "+s+"."),"PUBLIC"===o.type?r[s]:null;if(n.set(s,o),"PUBLIC"===o.type){var a=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[s])throw B.create("invalid-app-argument",{appName:s});return t[s]()};void 0!==o.serviceProps&&l(a,o.serviceProps),r[s]=a,t.prototype[s]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,s).apply(this,o.multipleInstances?t:[])}}for(var u=0,c=Object.keys(e);u<c.length;u++){var h=c[u];e[h]._addComponent(o)}return"PUBLIC"===o.type?r[s]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(H);return e.INTERNAL=i(i({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){l(e,t)},createSubscribe:w,ErrorFactory:v,deepExtend:l}),e}(),W=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();if("object"==typeof self&&self.self===self&&void 0!==self.firebase){z.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var Y=self.firebase.SDK_VERSION;Y&&Y.indexOf("LITE")>=0&&z.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var X=Q.initializeApp;Q.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return d()&&z.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),X.apply(void 0,t)};var J=Q;!function(t,e){t.INTERNAL.registerComponent(new S("platform-logger",(function(t){return new W(t)}),"PRIVATE")),t.registerVersion(j,"0.6.21",void 0),t.registerVersion("fire-js","")}(J);const $=J;$.registerVersion("firebase","8.5.0","app");var Z=function(t,e){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function tt(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var et,nt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},rt=rt||{},it=nt||self;function ot(){}function st(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function at(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ut="closure_uid_"+(1e9*Math.random()>>>0),ct=0;function ht(t,e,n){return t.call.apply(t.bind,arguments)}function lt(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function ft(t,e,n){return(ft=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ht:lt).apply(null,arguments)}function pt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function dt(){return Date.now()}function yt(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function vt(){this.j=this.j,this.i=this.i}vt.prototype.j=!1,vt.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,ut)&&t[ut]||(t[ut]=++ct)}(this)},vt.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var mt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},gt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function bt(t){return Array.prototype.concat.apply([],arguments)}function wt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function It(t){return/^[\s\xa0]*$/.test(t)}var Et,_t=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Tt(t,e){return-1!=t.indexOf(e)}function St(t,e){return t<e?-1:t>e?1:0}t:{var At=it.navigator;if(At){var Nt=At.userAgent;if(Nt){Et=Nt;break t}}Et=""}function Dt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ct(t){var e={};for(var n in t)e[n]=t[n];return e}var kt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ot(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<kt.length;o++)n=kt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Rt(t){return Rt[" "](t),t}Rt[" "]=ot;var xt,Lt,Pt=Tt(Et,"Opera"),Mt=Tt(Et,"Trident")||Tt(Et,"MSIE"),Ft=Tt(Et,"Edge"),Vt=Ft||Mt,Ut=Tt(Et,"Gecko")&&!(Tt(Et.toLowerCase(),"webkit")&&!Tt(Et,"Edge"))&&!(Tt(Et,"Trident")||Tt(Et,"MSIE"))&&!Tt(Et,"Edge"),qt=Tt(Et.toLowerCase(),"webkit")&&!Tt(Et,"Edge");function Bt(){var t=it.document;return t?t.documentMode:void 0}t:{var jt="",Kt=(Lt=Et,Ut?/rv:([^\);]+)(\)|;)/.exec(Lt):Ft?/Edge\/([\d\.]+)/.exec(Lt):Mt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Lt):qt?/WebKit\/(\S+)/.exec(Lt):Pt?/(?:Version)[ \/]?(\S+)/.exec(Lt):void 0);if(Kt&&(jt=Kt?Kt[1]:""),Mt){var Gt=Bt();if(null!=Gt&&Gt>parseFloat(jt)){xt=String(Gt);break t}}xt=jt}var zt,Ht={};function Qt(t){return function(t,e){var n=Ht;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,(function(){for(var e=0,n=_t(String(xt)).split("."),r=_t(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=St(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||St(0==s[2].length,0==a[2].length)||St(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}it.document&&Mt?zt=Bt()||parseInt(xt,10)||void 0:zt=void 0;var Wt=zt,Yt=!Mt||9<=Number(Wt),Xt=Mt&&!Qt("9"),Jt=function(){if(!it.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{it.addEventListener("test",ot,e),it.removeEventListener("test",ot,e)}catch(t){}return t}();function $t(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Zt(t,e){if($t.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Ut){t:{try{Rt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:te[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}$t.prototype.b=function(){this.defaultPrevented=!0},yt(Zt,$t);var te={2:"touch",3:"pen",4:"mouse"};Zt.prototype.b=function(){Zt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Xt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var ee="closure_listenable_"+(1e6*Math.random()|0),ne=0;function re(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++ne,this.Y=this.Z=!1}function ie(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function oe(t){this.src=t,this.a={},this.b=0}function se(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=mt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(ie(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function ae(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}oe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=ae(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new re(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var ue="closure_lm_"+(1e6*Math.random()|0),ce={};function he(t,e,n,r,i){if(r&&r.once)return fe(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)he(t,e[o],n,r,i);return null}return n=we(n),t&&t[ee]?t.va(e,n,at(r)?!!r.capture:!!r,i):le(t,e,n,!1,r,i)}function le(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=at(i)?!!i.capture:!!i;if(s&&!Yt)return null;var a=ge(t);if(a||(t[ue]=a=new oe(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=me,e=Yt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Jt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function fe(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)fe(t,e[o],n,r,i);return null}return n=we(n),t&&t[ee]?t.wa(e,n,at(r)?!!r.capture:!!r,i):le(t,e,n,!0,r,i)}function pe(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)pe(t,e[o],n,r,i);else r=at(r)?!!r.capture:!!r,n=we(n),t&&t[ee]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=ae(o=t.a[e],n,r,i))&&(ie(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=ge(t))&&(e=t.a[e.toString()],t=-1,e&&(t=ae(e,n,r,i)),(n=-1<t?e[t]:null)&&de(n))}function de(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[ee])se(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ge(e))?(se(n,t),0==n.b&&(n.src=null,e[ue]=null)):ie(t)}}}function ye(t){return t in ce?ce[t]:ce[t]="on"+t}function ve(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&de(t),n.call(r,e)}function me(t,e){if(t.Y)return!0;if(!Yt){if(!e)t:{e=["window","event"];for(var n=it,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return ve(t,e=new Zt(e,this))}return ve(t,new Zt(e,this))}function ge(t){return(t=t[ue])instanceof oe?t:null}var be="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(t){return"function"==typeof t?t:(t[be]||(t[be]=function(e){return t.handleEvent(e)}),t[be])}function Ie(){vt.call(this),this.c=new oe(this),this.J=this,this.C=null}function Ee(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new $t(e,t);else if(e instanceof $t)e.target=e.target||t;else{var i=e;Ot(e=new $t(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=_e(s,r,!0,e)&&i}if(i=_e(s=e.a=t,r,!0,e)&&i,i=_e(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=_e(s=e.a=n[o],r,!1,e)&&i}function _e(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&se(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}yt(Ie,vt),Ie.prototype[ee]=!0,(et=Ie.prototype).addEventListener=function(t,e,n,r){he(this,t,e,n,r)},et.removeEventListener=function(t,e,n,r){pe(this,t,e,n,r)},et.G=function(){if(Ie.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)ie(n[r]);delete e.a[t],e.b--}}this.C=null},et.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},et.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Te=it.JSON.stringify;function Se(){this.b=this.a=null}var Ae,Ne=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Ce}),(function(t){t.reset()}));function De(){var t=xe,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Ce(){this.next=this.b=this.a=null}function ke(t){it.setTimeout((function(){throw t}),0)}function Oe(t,e){Ae||function(){var t=it.Promise.resolve(void 0);Ae=function(){t.then(Le)}}(),Re||(Ae(),Re=!0),xe.add(t,e)}Se.prototype.add=function(t,e){var n=Ne.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Ce.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Ce.prototype.reset=function(){this.next=this.b=this.a=null};var Re=!1,xe=new Se;function Le(){for(var t;t=De();){try{t.a.call(t.b)}catch(t){ke(t)}var e=Ne;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Re=!1}function Pe(t,e){Ie.call(this),this.b=t||1,this.a=e||it,this.f=ft(this.Za,this),this.g=dt()}function Me(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Fe(t,e,n){if("function"==typeof t)n&&(t=ft(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=ft(t.handleEvent,t)}return 2147483647<Number(e)?-1:it.setTimeout(t,e||0)}function Ve(t){t.a=Fe((function(){t.a=null,t.c&&(t.c=!1,Ve(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}yt(Pe,Ie),(et=Pe.prototype).aa=!1,et.M=null,et.Za=function(){if(this.aa){var t=dt()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ee(this,"tick"),this.aa&&(Me(this),this.start()))}},et.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=dt())},et.G=function(){Pe.X.G.call(this),Me(this),delete this.a};var Ue=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}Z(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:Ve(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(it.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(vt);function qe(t){vt.call(this),this.b=t,this.a={}}yt(qe,vt);var Be=[];function je(t,e,n,r){Array.isArray(n)||(n&&(Be[0]=n.toString()),n=Be);for(var i=0;i<n.length;i++){var o=he(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Ke(t){Dt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&de(t)}),t),t.a={}}function Ge(){this.a=!0}function ze(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Te(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}qe.prototype.G=function(){qe.X.G.call(this),Ke(this)},qe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ge.prototype.info=function(){};var He={},Qe=null;function We(){return Qe=Qe||new Ie}function Ye(t){$t.call(this,He.Fa,t)}function Xe(t){var e=We();Ee(e,new Ye(e,t))}function Je(t,e){$t.call(this,He.STAT_EVENT,t),this.stat=e}function $e(t){var e=We();Ee(e,new Je(e,t))}function Ze(t){$t.call(this,He.Ga,t)}function tn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return it.setTimeout((function(){t()}),e)}He.Fa="serverreachability",yt(Ye,$t),He.STAT_EVENT="statevent",yt(Je,$t),He.Ga="timingevent",yt(Ze,$t);var en={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},nn={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function rn(){}function on(t){var e;return(e=t.a)||(e=t.a={}),e}function sn(){}rn.prototype.a=null;var an,un={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function cn(){$t.call(this,"d")}function hn(){$t.call(this,"c")}function ln(){}function fn(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new qe(this),this.P=pn,t=Vt?125:void 0,this.R=new Pe(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}yt(cn,$t),yt(hn,$t),yt(ln,rn),an=new ln;var pn=45e3,dn={},yn={};function vn(t,e,n){t.H=1,t.i=Vn(Rn(e)),t.j=n,t.I=!0,mn(t,null)}function mn(t,e){t.u=dt(),wn(t),t.l=Rn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),Jn(n.b,"t",r),t.D=0,t.a=zr(t.g,t.g.C?e:null),0<t.O&&(t.F=new Ue(ft(t.Ca,t,t.a),t.O)),je(t.J,t.a,"readystatechange",t.Xa),e=t.B?Ct(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Xe(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function gn(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=bn(t,n);if(i==yn){4==e&&(t.h=4,$e(14),r=!1),ze(t.c,t.f,null,"[Incomplete Response]");break}if(i==dn){t.h=4,$e(15),ze(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}ze(t.c,t.f,i,null),Sn(t,i)}4==e&&0==n.length&&(t.h=1,$e(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Fr(e),e.F=!0,$e(11))):(ze(t.c,t.f,n,"[Invalid Chunked Response]"),Tn(t),_n(t))}function bn(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?yn:(n=Number(e.substring(n,r)),isNaN(n)?dn:(r+=1)+n>e.length?yn:(e=e.substr(r,n),t.D=r+n,e))}function wn(t){t.T=dt()+t.P,In(t,t.P)}function In(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=tn(ft(t.Va,t),e)}function En(t){t.o&&(it.clearTimeout(t.o),t.o=null)}function _n(t){0==t.g.v||t.A||qr(t.g,t)}function Tn(t){En(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Me(t.R),Ke(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Sn(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||ir(n.b,t)))if(n.I=t.N,!t.C&&ir(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Ur(n),Dr(n)}Mr(n),$e(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=tn(ft(n.Sa,n),6e3));if(1>=rr(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else jr(n,11)}else if((t.C||n.a==t)&&Ur(n),!It(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(Tt(h,"spdy")||Tt(h,"quic")||Tt(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(or(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Fn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=dt()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=t;if((u=n).la=Gr(u,u.C?u.ga:null,u.fa),p.C){sr(u.b,p);var d=p,y=u.D;y&&d.setTimeout(y),d.o&&(En(d),wn(d)),u.a=p}else Pr(u);0<n.g.length&&Or(n)}else"stop"!=i[0]&&"close"!=i[0]||jr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?jr(n,7):Nr(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);Xe(4)}catch(t){}}function An(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(st(t)||"string"==typeof t)gt(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(st(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(st(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Nn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Nn)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Dn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Cn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Cn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Cn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(et=fn.prototype).setTimeout=function(t){this.P=t},et.Xa=function(t){t=t.target;var e=this.F;e&&3==_r(t)?e.f():this.Ca(t)},et.Ca=function(t){try{if(t==this.a)t:{var e=_r(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!Vt&&!this.a.$())){this.A||4!=e||7==n||Xe(8==n||0>=r?3:2),En(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!It(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,$e(12),Tn(this),_n(this);break t}ze(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Sn(this,u)}this.I?(gn(this,e,o),Vt&&this.b&&3==e&&(je(this.J,this.R,"tick",this.Wa),this.R.start())):(ze(this.c,this.f,o,null),Sn(this,o)),4==e&&Tn(this),this.b&&!this.A&&(4==e?qr(this.g,this):(this.b=!1,wn(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,$e(12)):(this.h=0,$e(13)),Tn(this),_n(this)}}}catch(t){}},et.Wa=function(){if(this.a){var t=_r(this.a),e=this.a.$();this.D<e.length&&(En(this),gn(this,t,e),this.b&&4!=t&&wn(this))}},et.cancel=function(){this.A=!0,Tn(this)},et.Va=function(){this.o=null;var t=dt();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(Xe(3),$e(17)),Tn(this),this.h=2,_n(this)):In(this,this.T-t)},(et=Nn.prototype).K=function(){Dn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},et.L=function(){return Dn(this),this.a.concat()},et.get=function(t,e){return Cn(this.b,t)?this.b[t]:e},et.set=function(t,e){Cn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},et.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var kn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function On(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof On){this.a=void 0!==e?e:t.a,xn(this,t.f),this.j=t.j,Ln(this,t.c),Pn(this,t.h),this.g=t.g,e=t.b;var n=new Qn;n.c=e.c,e.a&&(n.a=new Nn(e.a),n.b=e.b),Mn(this,n),this.i=t.i}else t&&(n=String(t).match(kn))?(this.a=!!e,xn(this,n[1]||"",!0),this.j=Un(n[2]||""),Ln(this,n[3]||"",!0),Pn(this,n[4]),this.g=Un(n[5]||"",!0),Mn(this,n[6]||"",!0),this.i=Un(n[7]||"")):(this.a=!!e,this.b=new Qn(null,this.a))}function Rn(t){return new On(t)}function xn(t,e,n){t.f=n?Un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ln(t,e,n){t.c=n?Un(e,!0):e}function Pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Mn(t,e,n){e instanceof Qn?(t.b=e,function(t,e){e&&!t.f&&(Wn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Yn(this,e),Jn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=qn(e,zn)),t.b=new Qn(e,t.a))}function Fn(t,e,n){t.b.set(e,n)}function Vn(t){return Fn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^dt()).toString(36)),t}function Un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Bn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Bn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}On.prototype.toString=function(){var t=[],e=this.f;e&&t.push(qn(e,jn,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(qn(e,jn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(qn(n,"/"==n.charAt(0)?Gn:Kn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",qn(n,Hn)),t.join("")};var jn=/[#\/\?@]/g,Kn=/[#\?:]/g,Gn=/[#\?]/g,zn=/[#\?@]/g,Hn=/#/g;function Qn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Wn(t){t.a||(t.a=new Nn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Yn(t,e){Wn(t),e=$n(t,e),Cn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Cn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Dn(t)))}function Xn(t,e){return Wn(t),e=$n(t,e),Cn(t.a.b,e)}function Jn(t,e,n){Yn(t,e),0<n.length&&(t.c=null,t.a.set($n(t,e),wt(n)),t.b+=n.length)}function $n(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(et=Qn.prototype).add=function(t,e){Wn(this),this.c=null,t=$n(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},et.forEach=function(t,e){Wn(this),this.a.forEach((function(n,r){gt(n,(function(n){t.call(e,n,r,this)}),this)}),this)},et.L=function(){Wn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},et.K=function(t){Wn(this);var e=[];if("string"==typeof t)Xn(this,t)&&(e=bt(e,this.a.get($n(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=bt(e,t[n])}return e},et.set=function(t,e){return Wn(this),this.c=null,Xn(this,t=$n(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},et.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},et.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Zn=function(t,e){this.b=t,this.a=e};function tr(t){this.g=t||er,t=it.PerformanceNavigationTiming?0<(t=it.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(it.ia&&it.ia.ya&&it.ia.ya()&&it.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var er=10;function nr(t){return!!t.b||!!t.a&&t.a.size>=t.f}function rr(t){return t.b?1:t.a?t.a.size:0}function ir(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function or(t,e){t.a?t.a.add(e):t.b=e}function sr(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function ar(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=tt(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return wt(t.c)}function ur(){}function cr(){this.a=new ur}function hr(t,e,n){var r=n||"";try{An(t,(function(t,n){var i=t;at(t)&&(i=Te(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function lr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}tr.prototype.cancel=function(){var t,e;if(this.c=ar(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=tt(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},ur.prototype.stringify=function(t){return it.JSON.stringify(t,void 0)},ur.prototype.parse=function(t){return it.JSON.parse(t,void 0)};var fr=it.JSON.parse;function pr(t){Ie.call(this),this.headers=new Nn,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=dr,this.D=this.F=!1}yt(pr,Ie);var dr="",yr=/^https?$/i,vr=["POST","PUT"];function mr(t){return"content-type"==t.toLowerCase()}function gr(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,br(t),Ir(t)}function br(t){t.u||(t.u=!0,Ee(t,"complete"),Ee(t,"error"))}function wr(t){if(t.b&&void 0!==rt&&(!t.s[1]||4!=_r(t)||2!=t.W()))if(t.l&&4==_r(t))Fe(t.za,0,t);else if(Ee(t,"readystatechange"),4==_r(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(kn)[1]||null;if(!o&&it.self&&it.self.location){var s=it.self.location.protocol;o=s.substr(0,s.length-1)}i=!yr.test(o?o.toLowerCase():"")}e=i}if(e)Ee(t,"complete"),Ee(t,"success");else{t.h=6;try{var a=2<_r(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",br(t)}}finally{Ir(t)}}}function Ir(t,e){if(t.a){Er(t);var n=t.a,r=t.s[0]?ot:null;t.a=null,t.s=null,e||Ee(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Er(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(it.clearTimeout(t.m),t.m=null)}function _r(t){return t.a?t.a.readyState:0}function Tr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Dt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Fn(t,e,n))}function Sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ar(t){this.pa=0,this.g=[],this.c=new Ge,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Sr("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Sr("baseRetryDelayMs",5e3,t),this.Ra=Sr("retryDelaySeedMs",1e4,t),this.Ma=Sr("forwardChannelMaxRetries",2,t),this.ma=Sr("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new tr(t&&t.concurrentRequestLimit),this.ka=new cr,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Nr(t){if(Cr(t),3==t.v){var e=t.R++,n=Rn(t.B);Fn(n,"SID",t.J),Fn(n,"RID",e),Fn(n,"TYPE","terminate"),xr(t,n),(e=new fn(t,t.c,e,void 0)).H=2,e.i=Vn(Rn(n)),n=!1,it.navigator&&it.navigator.sendBeacon&&(n=it.navigator.sendBeacon(e.i.toString(),"")),!n&&it.Image&&((new Image).src=e.i,n=!0),n||(e.a=zr(e.g,null),e.a.ba(e.i)),e.u=dt(),wn(e)}Kr(t)}function Dr(t){t.a&&(Fr(t),t.a.cancel(),t.a=null)}function Cr(t){Dr(t),t.j&&(it.clearTimeout(t.j),t.j=null),Ur(t),t.b.cancel(),t.h&&("number"==typeof t.h&&it.clearTimeout(t.h),t.h=null)}function kr(t,e){t.g.push(new Zn(t.Oa++,e)),3==t.v&&Or(t)}function Or(t){nr(t.b)||t.h||(t.h=!0,Oe(t.Ba,t),t.u=0)}function Rr(t,e){var n;n=e?e.f:t.R++;var r=Rn(t.B);Fn(r,"SID",t.J),Fn(r,"RID",n),Fn(r,"AID",t.P),xr(t,r),t.i&&t.l&&Tr(r,t.i,t.l),n=new fn(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Lr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),or(t.b,n),vn(n,r,e)}function xr(t,e){t.f&&An({},(function(t,n){Fn(e,n,t)}))}function Lr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?ft(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{hr(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Pr(t){t.a||t.j||(t.T=1,Oe(t.Aa,t),t.o=0)}function Mr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=tn(ft(t.Aa,t),Br(t,t.o)),t.o++,0))}function Fr(t){null!=t.s&&(it.clearTimeout(t.s),t.s=null)}function Vr(t){t.a=new fn(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Rn(t.la);Fn(e,"RID","rpc"),Fn(e,"SID",t.J),Fn(e,"CI",t.H?"0":"1"),Fn(e,"AID",t.P),xr(t,e),Fn(e,"TYPE","xmlhttp"),t.i&&t.l&&Tr(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Vn(Rn(e)),n.j=null,n.I=!0,mn(n,t)}function Ur(t){null!=t.m&&(it.clearTimeout(t.m),t.m=null)}function qr(t,e){var n=null;if(t.a==e){Ur(t),Fr(t),t.a=null;var r=2}else{if(!ir(t.b,e))return;n=e.s,sr(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=dt()-e.u;var i=t.u;Ee(r=We(),new Ze(r,n,e,i)),Or(t)}else Pr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(rr(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=tn(ft(t.Ba,t,e),Br(t,t.u)),t.u++,0)))}(t,e)||2==r&&Mr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:jr(t,5);break;case 4:jr(t,10);break;case 3:jr(t,6);break;default:jr(t,2)}}function Br(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function jr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=ft(t.Ya,t);n||(n=new On("//www.google.com/images/cleardot.gif"),it.location&&"http"==it.location.protocol||xn(n,"https"),Vn(n)),function(t,e){var n=new Ge;if(it.Image){var r=new Image;r.onload=pt(lr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=pt(lr,n,r,"TestLoadImage: error",!1,e),r.onabort=pt(lr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=pt(lr,n,r,"TestLoadImage: timeout",!1,e),it.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else $e(2);t.v=0,t.f&&t.f.ra(e),Kr(t),Cr(t)}function Kr(t){t.v=0,t.I=-1,t.f&&(0==ar(t.b).length&&0==t.g.length||(t.b.c.length=0,wt(t.g),t.g.length=0),t.f.qa())}function Gr(t,e,n){var r=function(t){return t instanceof On?Rn(t):new On(t,void 0)}(n);if(""!=r.c)e&&Ln(r,e+"."+r.c),Pn(r,r.h);else{var i=it.location;r=function(t,e,n,r){var i=new On(null,void 0);return t&&xn(i,t),e&&Ln(i,e),n&&Pn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Dt(t.V,(function(t,e){Fn(r,e,t)})),e=t.A,n=t.na,e&&n&&Fn(r,e,n),Fn(r,"VER",t.ha),xr(t,r),r}function zr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new pr(t.Na)).F=t.C,e}function Hr(){}function Qr(){if(Mt&&!(10<=Number(Wt)))throw Error("Environmental error: no available transport.")}function Wr(t,e){Ie.call(this),this.a=new Ar(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!It(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!It(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Jr(this)}function Yr(t){cn.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Xr(){hn.call(this),this.status=1}function Jr(t){this.a=t}(et=pr.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?on(this.H):on(an),this.a.onreadystatechange=ft(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void gr(this,t)}t=n||"";var i=new Nn(this.headers);r&&An(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=mr,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=it.FormData&&t instanceof it.FormData,!(0<=mt(vr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Er(this),0<this.o&&((this.D=function(t){return Mt&&Qt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=ft(this.xa,this)):this.m=Fe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){gr(this,t)}},et.xa=function(){void 0!==rt&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ee(this,"timeout"),this.abort(8))},et.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ee(this,"complete"),Ee(this,"abort"),Ir(this))},et.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ir(this,!0)),pr.X.G.call(this)},et.za=function(){this.j||(this.A||this.l||this.g?wr(this):this.Ua())},et.Ua=function(){wr(this)},et.W=function(){try{return 2<_r(this)?this.a.status:-1}catch(t){return-1}},et.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},et.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),fr(e)}},et.ua=function(){return this.h},et.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(et=Ar.prototype).ha=8,et.v=1,et.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new fn(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Ot(r=Ct(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Lr(this,n,e),Fn(i=Rn(this.B),"RID",t),Fn(i,"CVER",22),this.A&&Fn(i,"X-HTTP-Session-Id",this.A),xr(this,i),this.i&&r&&Tr(i,this.i,r),or(this.b,n),this.Ia&&Fn(i,"TYPE","init"),this.da?(Fn(i,"$req",e),Fn(i,"SID","null"),n.U=!0,vn(n,i,null)):vn(n,i,e),this.v=2}}else 3==this.v&&(t?Rr(this,t):0==this.g.length||nr(this.b)||Rr(this))},et.Aa=function(){if(this.j=null,Vr(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=tn(ft(this.Ta,this),t)}},et.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,$e(10),Dr(this),Vr(this))},et.Sa=function(){null!=this.m&&(this.m=null,Dr(this),Mr(this),$e(19))},et.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),$e(2)):(this.c.info("Failed to ping google.com"),$e(1))},(et=Hr.prototype).ta=function(){},et.sa=function(){},et.ra=function(){},et.qa=function(){},et.Ja=function(){},Qr.prototype.a=function(t,e){return new Wr(t,e)},yt(Wr,Ie),Wr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;$e(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=Gr(t,null,t.fa),Or(t)},Wr.prototype.close=function(){Nr(this.a)},Wr.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,kr(this.a,e)}else this.l?((e={}).__data__=Te(t),kr(this.a,e)):kr(this.a,t)},Wr.prototype.G=function(){this.a.f=null,delete this.f,Nr(this.a),delete this.a,Wr.X.G.call(this)},yt(Yr,cn),yt(Xr,hn),yt(Jr,Hr),Jr.prototype.ta=function(){Ee(this.a,"a")},Jr.prototype.sa=function(t){Ee(this.a,new Yr(t))},Jr.prototype.ra=function(t){Ee(this.a,new Xr(t))},Jr.prototype.qa=function(){Ee(this.a,"b")},Qr.prototype.createWebChannel=Qr.prototype.a,Wr.prototype.send=Wr.prototype.h,Wr.prototype.open=Wr.prototype.g,Wr.prototype.close=Wr.prototype.close,en.NO_ERROR=0,en.TIMEOUT=8,en.HTTP_ERROR=6,nn.COMPLETE="complete",sn.EventType=un,un.OPEN="a",un.CLOSE="b",un.ERROR="c",un.MESSAGE="d",Ie.prototype.listen=Ie.prototype.va,pr.prototype.listenOnce=pr.prototype.wa,pr.prototype.getLastError=pr.prototype.Qa,pr.prototype.getLastErrorCode=pr.prototype.ua,pr.prototype.getStatus=pr.prototype.W,pr.prototype.getResponseJson=pr.prototype.Pa,pr.prototype.getResponseText=pr.prototype.$,pr.prototype.send=pr.prototype.ba;var $r=en,Zr=nn,ti=He,ei=10,ni=11,ri=sn,ii=pr,oi=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();oi.o=-1;var si={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ai=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return n(e,t),e}(Error),ui=new F("@firebase/firestore");function ci(){return ui.logLevel}function hi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=k.DEBUG){var r=e.map(pi);ui.debug.apply(ui,c(["Firestore (8.5.0): "+t],r))}}function li(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=k.ERROR){var r=e.map(pi);ui.error.apply(ui,c(["Firestore (8.5.0): "+t],r))}}function fi(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ui.logLevel<=k.WARN){var r=e.map(pi);ui.warn.apply(ui,c(["Firestore (8.5.0): "+t],r))}}function pi(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function di(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.5.0) INTERNAL ASSERTION FAILED: "+t;throw li(e),new Error(e)}function yi(t,e){t||di()}function vi(t,e){return t}function mi(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var gi=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=mi(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function bi(t,e){return t<e?-1:t>e?1:0}function wi(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ii(t){return t+"\0"}var Ei=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ai(si.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ai(si.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ai(si.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ai(si.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?bi(this.nanoseconds,t.nanoseconds):bi(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),_i=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Ei(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ti(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Si(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ai(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Ni=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&di(),void 0===n?n=t.length-e:n>t.length-e&&di(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Di=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new ai(si.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Ni),Ci=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ki=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Ci.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new ai(si.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new ai(si.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ai(si.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new ai(si.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Ni),Oi=function(){function t(t){this.fields=t,t.sort(ki.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return wi(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Ri=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return bi(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Ri.EMPTY_BYTE_STRING=new Ri("");var xi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Li(t){if(yi(!!t),"string"==typeof t){var e=0,n=xi.exec(t);if(yi(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Pi(t.seconds),nanos:Pi(t.nanos)}}function Pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Mi(t){return"string"==typeof t?Ri.fromBase64String(t):Ri.fromUint8Array(t)}function Fi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vi(t){var e=t.mapValue.fields.__previous_value__;return Fi(e)?Vi(e):e}function Ui(t){var e=Li(t.mapValue.fields.__local_write_time__.timestampValue);return new Ei(e.seconds,e.nanos)}function qi(t){return null==t}function Bi(t){return 0===t&&1/t==-1/0}function ji(t){return"number"==typeof t&&Number.isInteger(t)&&!Bi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ki=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Di.fromString(e))},t.fromName=function(e){return new t(Di.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Di.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Di.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Di(e.slice()))},t}();function Gi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Fi(t)?4:10:di()}function zi(t,e){var n=Gi(t);if(n!==Gi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ui(t).isEqual(Ui(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Li(t.timestampValue),r=Li(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Mi(t.bytesValue).isEqual(Mi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Pi(t.geoPointValue.latitude)===Pi(e.geoPointValue.latitude)&&Pi(t.geoPointValue.longitude)===Pi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Pi(t.integerValue)===Pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Pi(t.doubleValue),r=Pi(e.doubleValue);return n===r?Bi(n)===Bi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return wi(t.arrayValue.values||[],e.arrayValue.values||[],zi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ti(n)!==Ti(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!zi(n[i],r[i])))return!1;return!0}(t,e);default:return di()}}function Hi(t,e){return void 0!==(t.values||[]).find((function(t){return zi(t,e)}))}function Qi(t,e){var n=Gi(t),r=Gi(e);if(n!==r)return bi(n,r);switch(n){case 0:return 0;case 1:return bi(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Pi(t.integerValue||t.doubleValue),r=Pi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Wi(t.timestampValue,e.timestampValue);case 4:return Wi(Ui(t),Ui(e));case 5:return bi(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Mi(t),r=Mi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=bi(n[i],r[i]);if(0!==o)return o}return bi(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=bi(Pi(t.latitude),Pi(e.latitude));return 0!==n?n:bi(Pi(t.longitude),Pi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Qi(n[i],r[i]);if(o)return o}return bi(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=bi(r[s],o[s]);if(0!==a)return a;var u=Qi(n[r[s]],i[o[s]]);if(0!==u)return u}return bi(r.length,o.length)}(t.mapValue,e.mapValue);default:throw di()}}function Wi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return bi(t,e);var n=Li(t),r=Li(e),i=bi(n.seconds,r.seconds);return 0!==i?i:bi(n.nanos,r.nanos)}function Yi(t){return Xi(t)}function Xi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Li(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Mi(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Ki.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Xi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Xi(t.fields[o])}return e+"}"}(t.mapValue):di();var e,n}function Ji(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function $i(t){return!!t&&"integerValue"in t}function Zi(t){return!!t&&"arrayValue"in t}function to(t){return!!t&&"nullValue"in t}function eo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function no(t){return!!t&&"mapValue"in t}var ro=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(ki.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return zi(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Gi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=no(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(ki.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!no(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function io(t){var e=[];return Si(t.fields||{},(function(t,n){var r=new ki([t]);if(no(n)){var i=io(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new Oi(e)}var oo=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,_i.min(),ro.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,ro.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,ro.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=ro.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=ro.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),so=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ao(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new so(t,e,n,r,i,o,s)}function uo(t){var e=vi(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Yi(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),qi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Eo(e.startAt)),e.endAt&&(n+="|ub:",n+=Eo(e.endAt)),e.h=n}return e.h}function co(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!To(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!zi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ao(t.startAt,e.startAt)&&Ao(t.endAt,e.endAt)}function ho(t){return Ki.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var lo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return n(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new fo(t,n,r):"array-contains"===n?new mo(t,r):"in"===n?new go(t,r):"not-in"===n?new bo(t,r):"array-contains-any"===n?new wo(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new po(t,n):new yo(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Qi(e,this.value)):null!==e&&Gi(this.value)===Gi(e)&&this.m(Qi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return di()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),fo=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ki.fromName(r.referenceValue),i}return n(e,t),e.prototype.matches=function(t){var e=Ki.comparator(t.key,this.key);return this.m(e)},e}(lo),po=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=vo(0,n),r}return n(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(lo),yo=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=vo(0,n),r}return n(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(lo);function vo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Ki.fromName(t.referenceValue)}))}var mo=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return n(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Zi(e)&&Hi(e.arrayValue,this.value)},e}(lo),go=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return n(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Hi(this.value.arrayValue,e)},e}(lo),bo=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return n(e,t),e.prototype.matches=function(t){if(Hi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Hi(this.value.arrayValue,e)},e}(lo),wo=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return n(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Zi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return Hi(e.value.arrayValue,t)}))},e}(lo),Io=function(t,e){this.position=t,this.before=e};function Eo(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return Yi(t)})).join(",")}var _o=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function To(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function So(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ki.comparator(Ki.fromName(s.referenceValue),n.key):Qi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ao(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!zi(t.position[n],e.position[n]))return!1;return!0}var No=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Do(t,e,n,r,i,o,s,a){return new No(t,e,n,r,i,o,s,a)}function Co(t){return new No(t)}function ko(t){return!qi(t.limit)&&"F"===t.limitType}function Oo(t){return!qi(t.limit)&&"L"===t.limitType}function Ro(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function xo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Lo(t){return null!==t.collectionGroup}function Po(t){var e=vi(t);if(null===e.p){e.p=[];var n=xo(e),r=Ro(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new _o(n)),e.p.push(new _o(ki.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new _o(ki.keyField(),u))}}}return e.p}function Mo(t){var e=vi(t);if(!e.T)if("F"===e.limitType)e.T=ao(e.path,e.collectionGroup,Po(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Po(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new _o(o.field,s))}var a=e.endAt?new Io(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Io(e.startAt.position,!e.startAt.before):null;e.T=ao(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function Fo(t,e,n){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Vo(t,e){return co(Mo(t),Mo(e))&&t.limitType===e.limitType}function Uo(t){return uo(Mo(t))+"|lt:"+t.limitType}function qo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Yi(e.value);var e})).join(", ")+"]"),qi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Eo(t.startAt)),t.endAt&&(e+=", endAt: "+Eo(t.endAt)),"Target("+e+")"}(Mo(t))+"; limitType="+t.limitType+")"}function Bo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ki.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!So(t.startAt,Po(t),e)||t.endAt&&So(t.endAt,Po(t),e))}(t,e)}function jo(t){return function(e,n){for(var r=!1,i=0,o=Po(t);i<o.length;i++){var s=o[i],a=Ko(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Ko(t,e,n){var r=t.field.isKeyField()?Ki.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Qi(r,i):di()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return di()}}function Go(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Bi(e)?"-0":e}}function zo(t){return{integerValue:""+t}}function Ho(t,e){return ji(e)?zo(e):Go(t,e)}var Qo=function(){this._=void 0};function Wo(t,e,n){return t instanceof Jo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof $o?Zo(t,e):t instanceof ts?es(t,e):function(t,e){var n=Xo(t,e),r=rs(n)+rs(t.A);return $i(n)&&$i(t.A)?zo(r):Go(t.R,r)}(t,e)}function Yo(t,e,n){return t instanceof $o?Zo(t,e):t instanceof ts?es(t,e):n}function Xo(t,e){return t instanceof ns?$i(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Jo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(Qo),$o=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n(e,t),e}(Qo);function Zo(t,e){for(var n=is(e),r=function(t){n.some((function(e){return zi(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ts=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return n(e,t),e}(Qo);function es(t,e){for(var n=is(e),r=function(t){n=n.filter((function(e){return!zi(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ns=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return n(e,t),e}(Qo);function rs(t){return Pi(t.integerValue||t.doubleValue)}function is(t){return Zi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var os=function(t,e){this.field=t,this.transform=e},ss=function(t,e){this.version=t,this.transformResults=e},as=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function us(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var cs=function(){};function hs(t,e,n){t instanceof ys?function(t,e,n){var r=t.value.clone(),i=gs(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof vs?function(t,e,n){if(us(t.precondition,e)){var r=gs(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(ms(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ls(t,e,n){t instanceof ys?function(t,e,n){if(us(t.precondition,e)){var r=t.value.clone(),i=bs(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(ds(e),r).setHasLocalMutations()}}(t,e,n):t instanceof vs?function(t,e,n){if(us(t.precondition,e)){var r=bs(t.fieldTransforms,n,e),i=e.data;i.setAll(ms(t)),i.setAll(r),e.convertToFoundDocument(ds(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){us(t.precondition,e)&&e.convertToNoDocument(_i.min())}(t,e)}function fs(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Xo(o.transform,s||null);null!=a&&(null==n&&(n=ro.empty()),n.set(o.field,a))}return n||null}function ps(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&wi(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof $o&&e instanceof $o||t instanceof ts&&e instanceof ts?wi(t.elements,e.elements,zi):t instanceof ns&&e instanceof ns?zi(t.A,e.A):t instanceof Jo&&e instanceof Jo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ds(t){return t.isFoundDocument()?t.version:_i.min()}var ys=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return n(e,t),e}(cs),vs=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return n(e,t),e}(cs);function ms(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function gs(t,e,n){var r=new Map;yi(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Yo(s,a,n[i]))}return r}function bs(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Wo(a,u,e))}return r}var ws,Is,Es=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return n(e,t),e}(cs),_s=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return n(e,t),e}(cs),Ts=function(t){this.count=t};function Ss(t){switch(t){case si.OK:return di();case si.CANCELLED:case si.UNKNOWN:case si.DEADLINE_EXCEEDED:case si.RESOURCE_EXHAUSTED:case si.INTERNAL:case si.UNAVAILABLE:case si.UNAUTHENTICATED:return!1;case si.INVALID_ARGUMENT:case si.NOT_FOUND:case si.ALREADY_EXISTS:case si.PERMISSION_DENIED:case si.FAILED_PRECONDITION:case si.ABORTED:case si.OUT_OF_RANGE:case si.UNIMPLEMENTED:case si.DATA_LOSS:return!0;default:return di()}}function As(t){if(void 0===t)return li("GRPC error has no .code"),si.UNKNOWN;switch(t){case ws.OK:return si.OK;case ws.CANCELLED:return si.CANCELLED;case ws.UNKNOWN:return si.UNKNOWN;case ws.DEADLINE_EXCEEDED:return si.DEADLINE_EXCEEDED;case ws.RESOURCE_EXHAUSTED:return si.RESOURCE_EXHAUSTED;case ws.INTERNAL:return si.INTERNAL;case ws.UNAVAILABLE:return si.UNAVAILABLE;case ws.UNAUTHENTICATED:return si.UNAUTHENTICATED;case ws.INVALID_ARGUMENT:return si.INVALID_ARGUMENT;case ws.NOT_FOUND:return si.NOT_FOUND;case ws.ALREADY_EXISTS:return si.ALREADY_EXISTS;case ws.PERMISSION_DENIED:return si.PERMISSION_DENIED;case ws.FAILED_PRECONDITION:return si.FAILED_PRECONDITION;case ws.ABORTED:return si.ABORTED;case ws.OUT_OF_RANGE:return si.OUT_OF_RANGE;case ws.UNIMPLEMENTED:return si.UNIMPLEMENTED;case ws.DATA_LOSS:return si.DATA_LOSS;default:return di()}}(Is=ws||(ws={}))[Is.OK=0]="OK",Is[Is.CANCELLED=1]="CANCELLED",Is[Is.UNKNOWN=2]="UNKNOWN",Is[Is.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Is[Is.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Is[Is.NOT_FOUND=5]="NOT_FOUND",Is[Is.ALREADY_EXISTS=6]="ALREADY_EXISTS",Is[Is.PERMISSION_DENIED=7]="PERMISSION_DENIED",Is[Is.UNAUTHENTICATED=16]="UNAUTHENTICATED",Is[Is.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Is[Is.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Is[Is.ABORTED=10]="ABORTED",Is[Is.OUT_OF_RANGE=11]="OUT_OF_RANGE",Is[Is.UNIMPLEMENTED=12]="UNIMPLEMENTED",Is[Is.INTERNAL=13]="INTERNAL",Is[Is.UNAVAILABLE=14]="UNAVAILABLE",Is[Is.DATA_LOSS=15]="DATA_LOSS";var Ns=function(){function t(t,e){this.comparator=t,this.root=e||Cs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Cs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Cs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ds(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ds(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ds(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ds(this.root,t,this.comparator,!0)},t}(),Ds=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Cs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw di();if(this.right.isRed())throw di();var t=this.left.check();if(t!==this.right.check())throw di();return t+(this.isRed()?0:1)},t}();Cs.EMPTY=null,Cs.RED=!0,Cs.BLACK=!1,Cs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw di()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw di()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw di()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw di()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw di()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Cs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ks=function(){function t(t){this.comparator=t,this.data=new Ns(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Os(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Os(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Os=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Rs=new Ns(Ki.comparator);function xs(){return Rs}var Ls=new Ns(Ki.comparator);function Ps(){return Ls}var Ms=new Ns(Ki.comparator);function Fs(){return Ms}var Vs=new ks(Ki.comparator);function Us(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var qs=new ks(bi);function Bs(){return qs}var js=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Ks.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(_i.min(),r,Bs(),xs(),Us())},t}(),Ks=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ri.EMPTY_BYTE_STRING,n,Us(),Us(),Us())},t}(),Gs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},zs=function(t,e){this.targetId=t,this.V=e},Hs=function(t,e,n,r){void 0===n&&(n=Ri.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Qs=function(){function t(){this.S=0,this.D=Xs(),this.C=Ri.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Us(),e=Us(),n=Us();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:di()}})),new Ks(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Xs()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ws=function(){function t(t){this.W=t,this.G=new Map,this.H=xs(),this.J=Ys(),this.Y=new ks(bi)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:di()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(ho(i))if(0===n){var o=new Ki(i.path);this.tt(e,o,oo.newNoDocument(o,_i.min()))}else yi(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&ho(o.target)){var s=new Ki(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,oo.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=Us();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new js(t,n,this.Y,this.H,r);return this.H=xs(),this.J=Ys(),this.Y=new ks(bi),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Qs,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ks(bi),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||hi("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Qs),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Ys(){return new Ns(Ki.comparator)}function Xs(){return new Ns(Ki.comparator)}var Js={asc:"ASCENDING",desc:"DESCENDING"},$s={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Zs=function(t,e){this.databaseId=t,this.I=e};function ta(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ea(t,e){return t.I?e.toBase64():e.toUint8Array()}function na(t,e){return ta(t,e.toTimestamp())}function ra(t){return yi(!!t),_i.fromTimestamp(function(t){var e=Li(t);return new Ei(e.seconds,e.nanos)}(t))}function ia(t,e){return function(t){return new Di(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function oa(t){var e=Di.fromString(t);return yi(Ca(e)),e}function sa(t,e){return ia(t.databaseId,e.path)}function aa(t,e){var n=oa(e);if(n.get(1)!==t.databaseId.projectId)throw new ai(si.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ai(si.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ki(la(n))}function ua(t,e){return ia(t.databaseId,e)}function ca(t){var e=oa(t);return 4===e.length?Di.emptyPath():la(e)}function ha(t){return new Di(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function la(t){return yi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function fa(t,e,n){return{name:sa(t,e),fields:n.toProto().mapValue.fields}}function pa(t,e,n){var r=aa(t,e.name),i=ra(e.updateTime),o=new ro({mapValue:{fields:e.fields}}),s=oo.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function da(t,e){var n;if(e instanceof ys)n={update:fa(t,e.key,e.value)};else if(e instanceof Es)n={delete:sa(t,e.key)};else if(e instanceof vs)n={update:fa(t,e.key,e.data),updateMask:Da(e.fieldMask)};else{if(!(e instanceof _s))return di();n={verify:sa(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Jo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof $o)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ts)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ns)return{fieldPath:e.field.canonicalString(),increment:n.A};throw di()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:na(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:di()}(t,e.precondition)),n}function ya(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?as.updateTime(ra(t.updateTime)):void 0!==t.exists?as.exists(t.exists):as.none()}(e.currentDocument):as.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)yi("REQUEST_TIME"===e.setToServerValue),n=new Jo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new $o(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new ts(i)}else"increment"in e?n=new ns(t,e.increment):di();var o=ki.fromServerFormat(e.fieldPath);return new os(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=aa(t,e.update.name),o=new ro({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new Oi(e.map((function(t){return ki.fromServerFormat(t)})))}(e.updateMask);return new vs(i,o,s,n,r)}return new ys(i,o,n,r)}if(e.delete){var a=aa(t,e.delete);return new Es(a,n)}if(e.verify){var u=aa(t,e.verify);return new _s(u,n)}return di()}function va(t,e){return{documents:[ua(t,e.path)]}}function ma(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ua(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ua(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(eo(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NAN"}};if(to(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(eo(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NOT_NAN"}};if(to(t.value))return{unaryFilter:{field:Ta(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ta(t.field),op:_a(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Ta(t.field),direction:Ea(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||qi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=wa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=wa(e.endAt)),n}function ga(t){var e=ca(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){yi(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=ba(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new _o(Sa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return qi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Ia(n.startAt));var h=null;return n.endAt&&(h=Ia(n.endAt)),Do(e,i,a,s,u,"F",c,h)}function ba(t){return t?void 0!==t.unaryFilter?[Na(t)]:void 0!==t.fieldFilter?[Aa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return ba(t)})).reduce((function(t,e){return t.concat(e)})):di():[]}function wa(t){return{before:t.before,values:t.position}}function Ia(t){var e=!!t.before,n=t.values||[];return new Io(n,e)}function Ea(t){return Js[t]}function _a(t){return $s[t]}function Ta(t){return{fieldPath:t.canonicalString()}}function Sa(t){return ki.fromServerFormat(t.fieldPath)}function Aa(t){return lo.create(Sa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return di()}}(t.fieldFilter.op),t.fieldFilter.value)}function Na(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Sa(t.unaryFilter.field);return lo.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Sa(t.unaryFilter.field);return lo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Sa(t.unaryFilter.field);return lo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Sa(t.unaryFilter.field);return lo.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return di()}}function Da(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Ca(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ka(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Ra(e)),e=Oa(t.get(n),e);return Ra(e)}function Oa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ra(t){return t+""}function xa(t){var e=t.length;if(yi(e>=2),2===e)return yi(""===t.charAt(0)&&""===t.charAt(1)),Di.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&di(),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:di()}o=s+2}return new Di(r)}var La=function(t,e){this.seconds=t,this.nanoseconds=e},Pa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Pa.store="owner",Pa.key="owner";var Ma=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Ma.store="mutationQueues",Ma.keyPath="userId";var Fa=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Fa.store="mutations",Fa.keyPath="batchId",Fa.userMutationsIndex="userMutationsIndex",Fa.userMutationsKeyPath=["userId","batchId"];var Va=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ka(e)]},t.key=function(t,e,n){return[t,ka(e),n]},t}();Va.store="documentMutations",Va.PLACEHOLDER=new Va;var Ua=function(t,e){this.path=t,this.readTime=e},qa=function(t,e){this.path=t,this.version=e},Ba=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ba.store="remoteDocuments",Ba.readTimeIndex="readTimeIndex",Ba.readTimeIndexPath="readTime",Ba.collectionReadTimeIndex="collectionReadTimeIndex",Ba.collectionReadTimeIndexPath=["parentPath","readTime"];var ja=function(t){this.byteSize=t};ja.store="remoteDocumentGlobal",ja.key="remoteDocumentGlobalKey";var Ka=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ka.store="targets",Ka.keyPath="targetId",Ka.queryTargetsIndexName="queryTargetsIndex",Ka.queryTargetsKeyPath=["canonicalId","targetId"];var Ga=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ga.store="targetDocuments",Ga.keyPath=["targetId","path"],Ga.documentTargetsIndex="documentTargetsIndex",Ga.documentTargetsKeyPath=["path","targetId"];var za=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};za.key="targetGlobalKey",za.store="targetGlobal";var Ha=function(t,e){this.collectionId=t,this.parent=e};Ha.store="collectionParents",Ha.keyPath=["collectionId","parent"];var Qa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Qa.store="clientMetadata",Qa.keyPath="clientId";var Wa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Wa.store="bundles",Wa.keyPath="bundleId";var Ya=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Ya.store="namedQueries",Ya.keyPath="name";var Xa=c(c([],c(c([],c(c([],c(c([],[Ma.store,Fa.store,Va.store,Ba.store,Ka.store,Pa.store,za.store,Ga.store]),[Qa.store])),[ja.store])),[Ha.store])),[Wa.store,Ya.store]),Ja="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$a=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),Za=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},tu=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&di(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),eu=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Za,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new iu(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=cu(e.target.error);n.ft.reject(new iu(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new iu(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(hi("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new su(e)},t}(),nu=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(p())&&li("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return hi("SimpleDb","Removing database:",t),au(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=p(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return o(this,void 0,void 0,(function(){var e,n=this;return s(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(hi("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new iu(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new ai(si.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new iu(t,n))},i.onupgradeneeded=function(t){hi("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){hi("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return o(this,void 0,void 0,(function(){var i,o,a,u,c;return s(this,(function(h){switch(h.label){case 0:i="readonly"===e,o=0,a=function(){var e,a,c,h,l;return s(this,(function(s){switch(s.label){case 0:++o,s.label=1;case 1:return s.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=s.sent(),e=eu.open(u.db,t,i?"readonly":"readwrite",n),a=r(e).catch((function(t){return e.abort(t),tu.reject(t)})).toPromise(),c={},a.catch((function(){})),[4,e.dt];case 3:return[2,(c.value=(s.sent(),a),c)];case 4:return h=s.sent(),l="FirebaseError"!==h.name&&o<3,hi("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}}))},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ru=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return au(this.Pt.delete())},t}(),iu=function(t){function e(e,n){var r=this;return(r=t.call(this,si.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return n(e,t),e}(ai);function ou(t){return"IndexedDbTransactionError"===t.name}var su=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(hi("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(hi("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),au(n)},t.prototype.add=function(t){return hi("SimpleDb","ADD",this.store.name,t,t),au(this.store.add(t))},t.prototype.get=function(t){var e=this;return au(this.store.get(t)).next((function(n){return void 0===n&&(n=null),hi("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return hi("SimpleDb","DELETE",this.store.name,t),au(this.store.delete(t))},t.prototype.count=function(){return hi("SimpleDb","COUNT",this.store.name),au(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){hi("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new tu((function(n,r){e.onerror=function(t){var e=cu(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new tu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ru(i),s=e(i.primaryKey,i.value,o);if(s instanceof tu){var a=s.catch((function(t){return o.done(),tu.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return tu.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function au(t){return new tu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=cu(t.target.error);n(e)}}))}var uu=!1;function cu(t){var e=nu._t(p());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new ai("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return uu||(uu=!0,setTimeout((function(){throw r}),0)),r}}return t}var hu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return n(e,t),e}($a);function lu(t,e){var n=vi(t);return nu.It(n.Mt,e)}var fu=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&hs(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ls(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ls(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(_i.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Us())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&wi(this.mutations,t.mutations,(function(t,e){return ps(t,e)}))&&wi(this.baseMutations,t.baseMutations,(function(t,e){return ps(t,e)}))},t}(),pu=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){yi(e.mutations.length===r.length);for(var i=Fs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),du=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=_i.min()),void 0===o&&(o=_i.min()),void 0===s&&(s=Ri.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),yu=function(t){this.Lt=t};function vu(t,e){if(e.document)return pa(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ki.fromSegments(e.noDocument.path),r=Iu(e.noDocument.readTime),i=oo.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ki.fromSegments(e.unknownDocument.path);return r=Iu(e.unknownDocument.version),oo.newUnknownDocument(o,r)}return di()}function mu(t,e,n){var r=gu(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:sa(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:ta(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Ba(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=wu(e.version);return s=e.hasCommittedMutations,new Ba(null,new Ua(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=wu(e.version);return new Ba(new qa(c,h),null,null,!0,r,i)}return di()}function gu(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function bu(t){var e=new Ei(t[0],t[1]);return _i.fromTimestamp(e)}function wu(t){var e=t.toTimestamp();return new La(e.seconds,e.nanoseconds)}function Iu(t){var e=new Ei(t.seconds,t.nanoseconds);return _i.fromTimestamp(e)}function Eu(t,e){for(var n=(e.baseMutations||[]).map((function(e){return ya(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return ya(t.Lt,e)})),a=Ei.fromMillis(e.localWriteTimeMs);return new fu(e.batchId,a,n,s)}function _u(t){var e,n,r=Iu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Iu(t.lastLimboFreeSnapshotVersion):_i.min();return void 0!==t.query.documents?(yi(1===(n=t.query).documents.length),e=Mo(Co(ca(n.documents[0])))):e=function(t){return Mo(ga(t))}(t.query),new du(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Ri.fromBase64String(t.resumeToken))}function Tu(t,e){var n,r=wu(e.snapshotVersion),i=wu(e.lastLimboFreeSnapshotVersion);n=ho(e.target)?va(t.Lt,e.target):ma(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ka(e.targetId,uo(e.target),r,o,e.sequenceNumber,i,n)}function Su(t){var e=ga({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Fo(e,e.limit,"L"):e}var Au=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Nu(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:Iu(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Nu(t).put({bundleId:(n=e).id,createTime:wu(ra(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Du(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Su(e.bundledQuery),readTime:Iu(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Du(t).put(function(t){return{name:t.name,readTime:wu(ra(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Nu(t){return lu(t,Wa.store)}function Du(t){return lu(t,Ya.store)}var Cu=function(){function t(){this.Bt=new ku}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),tu.resolve()},t.prototype.getCollectionParents=function(t,e){return tu.resolve(this.Bt.getEntries(e))},t}(),ku=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ks(Di.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ks(Di.comparator)).toArray()},t}(),Ou=function(){function t(){this.qt=new ku}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:ka(i)};return Ru(t).put(o)}return tu.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ii(e),""],!1,!0);return Ru(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(xa(o.parent))}return n}))},t}();function Ru(t){return lu(t,Ha.store)}var xu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Lu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Pu(t,e,n){var r=t.store(Fa.store),i=t.store(Va.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){yi(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Va.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return tu.waitFor(o).next((function(){return c}))}function Mu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw di();e=t.noDocument}return JSON.stringify(e).length}Lu.DEFAULT_COLLECTION_PERCENTILE=10,Lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lu.DEFAULT=new Lu(41943040,Lu.DEFAULT_COLLECTION_PERCENTILE,Lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lu.DISABLED=new Lu(-1,0,0);var Fu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return yi(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Uu(t).Ot({index:Fa.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=qu(t),s=Uu(t);return s.add({}).next((function(a){yi("number"==typeof a);for(var u=new fu(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return da(t.Lt,e)})),i=n.mutations.map((function(e){return da(t.Lt,e)}));return new Fa(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ks((function(t,e){return bi(t.canonicalString(),e.canonicalString())})),f=0,p=r;f<p.length;f++){var d=p[f],y=Va.key(i.userId,d.key.path,a);l=l.add(d.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Va.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),tu.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Uu(t).get(e).next((function(t){return t?(yi(t.userId===n.userId),Eu(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?tu.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Uu(t).Ot({index:Fa.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(yi(e.batchId>=r),o=Eu(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Uu(t).Ot({index:Fa.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Uu(t).Nt(Fa.userMutationsIndex,n).next((function(t){return t.map((function(t){return Eu(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Va.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return qu(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=xa(u);if(a===n.userId&&e.path.isEqual(h))return Uu(t).get(c).next((function(t){if(!t)throw di();yi(t.userId===n.userId),o.push(Eu(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ks(bi),i=[];return e.forEach((function(e){var o=Va.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=qu(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=xa(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),tu.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Va.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ks(bi);return qu(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=xa(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Uu(t).get(e).next((function(t){if(null===t)throw di();yi(t.userId===n.userId),r.push(Eu(n.R,t))})))})),tu.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Pu(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),tu.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return tu.resolve();var r=IDBKeyRange.lowerBound(Va.prefixForUser(e.userId)),i=[];return qu(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=xa(t[1]);i.push(o)}else r.done()})).next((function(){yi(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Vu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Bu(t).get(this.userId).next((function(t){return t||new Ma(e.userId,-1,"")}))},t}();function Vu(t,e,n){var r=Va.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return qu(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Uu(t){return lu(t,Fa.store)}function qu(t){return lu(t,Va.store)}function Bu(t){return lu(t,Ma.store)}var ju=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Ku=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new ju(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return _i.fromTimestamp(new Ei(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return Gu(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return yi(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Gu(t).Ot((function(s,a){var u=_u(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return tu.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return Gu(t).Ot((function(t,n){var r=_u(n);e(r)}))},t.prototype.Xt=function(t){return zu(t).get(za.key).next((function(t){return yi(null!==t),t}))},t.prototype.Zt=function(t,e){return zu(t).put(za.key,e)},t.prototype.te=function(t,e){return Gu(t).put(Tu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=uo(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Gu(t).Ot({range:r,index:Ka.queryTargetsIndexName},(function(t,n,r){var o=_u(n);co(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Hu(t);return e.forEach((function(e){var s=ka(e.path);i.push(o.put(new Ga(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),tu.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Hu(t);return tu.forEach(e,(function(e){var o=ka(e.path);return tu.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Hu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Hu(t),i=Us();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=xa(t[1]),o=new Ki(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=ka(e.path),r=IDBKeyRange.bound([n],[Ii(n)],!1,!0),i=0;return Hu(t).Ot({index:Ga.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return Gu(t).get(e).next((function(t){return t?_u(t):null}))},t}();function Gu(t){return lu(t,Ka.store)}function zu(t){return lu(t,za.store)}function Hu(t){return lu(t,Ga.store)}function Qu(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){if(t.code!==si.FAILED_PRECONDITION||t.message!==Ja)throw t;return hi("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Wu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=bi(n,i);return 0===s?bi(r,o):s}var Yu=function(){function t(t){this.ne=t,this.buffer=new ks(Wu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Wu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Xu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;hi("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return o(e,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ou(e=n.sent())?(hi("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Qu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),Ju=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return tu.resolve(oi.o);var r=new Yu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(hi("LruGarbageCollector","Garbage collection skipped; disabled"),tu.resolve(xu)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(hi("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),xu):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>c.params.maximumSequenceNumbersToCollect?(hi("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)})).next((function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)})).next((function(t){return u=Date.now(),ci()<=k.DEBUG&&hi("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),tu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),$u=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Ju(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return Zu(t,n)},t.prototype.removeReference=function(t,e,n){return Zu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Zu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Bu(t).$t((function(r){return Vu(t,r,e).next((function(t){return t&&(n=!0),tu.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),Hu(t).delete([0,ka(s.path)])}))}));i.push(u)}})).next((function(){return tu.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Zu(t,e)},t.prototype.we=function(t,e){var n,r=Hu(t),i=oi.o;return r.Ot({index:Ga.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==oi.o&&e(new Ki(xa(n)),i),i=a,n=s):i=oi.o})).next((function(){i!==oi.o&&e(new Ki(xa(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Zu(t,e){return Hu(t).put(function(t,e){return new Ga(0,ka(t.path),e)}(e,t.currentSequenceNumber))}var tc=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Si(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return Ai(this.inner)},t}(),ec=function(){function t(){this.changes=new tc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:_i.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:oo.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?tu.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),nc=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return oc(t).put(sc(e),n)},t.prototype.removeEntry=function(t,e){var n=oc(t),r=sc(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return oc(t).get(sc(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return oc(t).get(sc(e)).next((function(t){return{document:n.ye(e,t),size:Mu(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=xs();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=xs(),i=new Ns(Ki.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Mu(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return tu.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return oc(t).Ot({range:r},(function(t,e,r){for(var s=Ki.fromSegments(t);o&&Ki.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=xs(),o=e.path.length+1,s={};if(n.isEqual(_i.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=gu(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Ba.collectionReadTimeIndex}return oc(t).Ot(s,(function(t,n,s){if(t.length===o){var a=vu(r.R,n);e.path.isPrefixOf(a.key.path)?Bo(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new rc(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return ic(t).get(ja.key).next((function(t){return yi(!!t),t}))},t.prototype.me=function(t,e){return ic(t).put(ja.key,e)},t.prototype.ye=function(t,e){if(e){var n=vu(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(_i.min()))return n}return oo.newInvalidDocument(t)},t}(),rc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new tc((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return n(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ks((function(t,e){return bi(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=mu(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Mu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=mu(e.Ie.R,oo.newNoDocument(o,_i.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),tu.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(ec);function ic(t){return lu(t,ja.store)}function oc(t){return lu(t,Ba.store)}function sc(t){return t.path.toArray()}var ac=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;yi(n<r&&n>=0&&r<=11);var o=new eu("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Pa.store)}(t),function(t){t.createObjectStore(Ma.store,{keyPath:Ma.keyPath}),t.createObjectStore(Fa.store,{keyPath:Fa.keyPath,autoIncrement:!0}).createIndex(Fa.userMutationsIndex,Fa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Va.store)}(t),uc(t),function(t){t.createObjectStore(Ba.store)}(t));var s=tu.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Ga.store),t.deleteObjectStore(Ka.store),t.deleteObjectStore(za.store)}(t),uc(t)),s=s.next((function(){return function(t){var e=t.store(za.store),n=new za(0,0,_i.min().toTimestamp(),0);return e.put(za.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Fa.store).Nt().next((function(n){t.deleteObjectStore(Fa.store),t.createObjectStore(Fa.store,{keyPath:Fa.keyPath,autoIncrement:!0}).createIndex(Fa.userMutationsIndex,Fa.userMutationsKeyPath,{unique:!0});var r=e.store(Fa.store),i=n.map((function(t){return r.put(t)}));return tu.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Qa.store,{keyPath:Qa.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(ja.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ba.store);e.createIndex(Ba.readTimeIndex,Ba.readTimeIndexPath,{unique:!1}),e.createIndex(Ba.collectionReadTimeIndex,Ba.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(Wa.store,{keyPath:Wa.keyPath})}(t),function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Ba.store).Ot((function(t,n){e+=Mu(n)})).next((function(){var n=new ja(e);return t.store(ja.store).put(ja.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(Ma.store),r=t.store(Fa.store);return n.Nt().next((function(n){return tu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Fa.userMutationsIndex,i).next((function(r){return tu.forEach(r,(function(r){yi(r.userId===n.userId);var i=Eu(e.R,r);return Pu(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store(Ga.store),n=t.store(Ba.store);return t.store(za.store).get(za.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Di(n),s=function(t){return[0,ka(t)]}(o);r.push(e.get(s).next((function(n){return n?tu.resolve():function(n){return e.put(new Ga(0,ka(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return tu.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(Ha.store,{keyPath:Ha.keyPath});var n=e.store(Ha.store),r=new ku,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ka(i)})}};return e.store(Ba.store).Ot({kt:!0},(function(t,e){var n=new Di(t);return i(n.popLast())})).next((function(){return e.store(Va.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],xa(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Ka.store);return n.Ot((function(t,r){var i=_u(r),o=Tu(e.R,i);return n.put(o)}))},t}();function uc(t){t.createObjectStore(Ga.store,{keyPath:Ga.keyPath}).createIndex(Ga.documentTargetsIndex,Ga.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath}).createIndex(Ka.queryTargetsIndexName,Ka.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(za.store)}var cc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",hc=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new ai(si.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new $u(this,i),this.Le=n+"main",this.R=new yu(u),this.Be=new nu(this.Le,11,new ac(this.R)),this.qe=new Ku(this.referenceDelegate,this.R),this.Ut=new Ou,this.Ue=function(t,e){return new nc(t,e)}(this.R,this.Ut),this.Qe=new Au,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&li("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new ai(si.FAILED_PRECONDITION,cc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new oi(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return o(e,void 0,void 0,(function(){return s(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return o(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return o(e,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return fc(e).put(new Qa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(ou(e))return hi("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return hi("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return lc(t).get(Pa.key).next((function(t){return tu.resolve(e.tn(t))}))},t.prototype.en=function(t){return fc(t).delete(this.clientId)},t.prototype.nn=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i=this;return s(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=lu(t,Qa.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return tu.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?tu.resolve(!0):lc(t).get(Pa.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new ai(si.FAILED_PRECONDITION,cc);return!1}}return!(!e.networkEnabled||!e.inForeground)||fc(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&hi("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return o(this,void 0,void 0,(function(){var t=this;return s(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Pa.store,Qa.store],(function(e){var n=new hu(e,oi.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return fc(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Fu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;hi("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,Xa,(function(o){return i=new hu(o,r.Ne?r.Ne.next():oi.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw li("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new ai(si.FAILED_PRECONDITION,Ja);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return lc(t).get(Pa.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new ai(si.FAILED_PRECONDITION,cc)}))},t.prototype.Ze=function(t){var e=new Pa(this.clientId,this.allowTabSynchronization,Date.now());return lc(t).put(Pa.key,e)},t.yt=function(){return nu.yt()},t.prototype.Xe=function(t){var e=this,n=lc(t);return n.get(Pa.key).next((function(t){return e.tn(t)?(hi("IndexedDbPersistence","Releasing primary lease."),n.delete(Pa.key)):tu.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(li("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return hi("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return li("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){li("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function lc(t){return lu(t,Pa.store)}function fc(t){return lu(t,Qa.store)}function pc(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var dc=function(t,e){this.progress=t,this.wn=e},yc=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ki.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Lo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ki(e)).next((function(t){var e=Ps();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Ps();return this.Ut.getCollectionParents(t,i).next((function(s){return tu.forEach(s,(function(s){var a=function(t,e){return new No(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=oo.newInvalidDocument(c),r=r.insert(c,h)),ls(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Bo(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Us(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof vs&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),vc=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Us(),i=Us(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),mc=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(_i.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(o){var s=i.Cn(e,o);return(ko(e)||Oo(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(ci()<=k.DEBUG&&hi("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),qo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return s.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new ks(jo(t));return e.forEach((function(e,r){Bo(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return ci()<=k.DEBUG&&hi("QueryEngine","Using full collection scan to execute query:",qo(e)),this.Sn.getDocumentsMatchingQuery(t,e,_i.min())},t}(),gc=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Ns(bi),this.kn=new tc((function(t){return uo(t)}),co),this.On=_i.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new yc(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function bc(t,e,n,r){return new gc(t,e,n,r)}function wc(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o;return s(this,(function(s){switch(s.label){case 0:return n=vi(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new yc(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Us(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=e;p<d.length;p++){var y=d[p];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function Ic(t,e){var n=vi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=tu.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);yi(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Ec(t){var e=vi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function _c(t,e){var n=vi(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return yi(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=xs();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Tc(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(_i.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return tu.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function Tc(t,e,n,r,i){var o=Us();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=xs();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(_i.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):hi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Sc(t,e){var n=vi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Ac(t,e){var n=vi(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,tu.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new du(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Nc(t,e,n){return o(this,void 0,void 0,(function(){var r,i,o,a;return s(this,(function(s){switch(s.label){case 0:r=vi(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",s.label=1;case 1:return s.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:if(!ou(a=s.sent()))throw a;return hi("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function Dc(t,e,n){var r=vi(t),i=_i.min(),o=Us();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=vi(t),i=r.kn.get(n);return void 0!==i?tu.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Mo(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:_i.min(),n?o:Us())})).next((function(t){return{documents:t,Bn:o}}))}))}function Cc(t,e){var n=vi(t),r=vi(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function kc(t){var e=vi(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=vi(t),i=xs(),o=gu(n),s=oc(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:Ba.readTimeIndex,range:a},(function(t,e){var n=vu(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:bu(o)}}))}(e.$n,t,e.On)})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function Oc(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){return[2,(e=vi(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=oc(t),n=_i.min();return e.Ot({index:Ba.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=bu(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.On=t}))]}))}))}function Rc(t,e,n,r){return o(this,void 0,void 0,(function(){var i,o,a,u,c,h,l,f,p,d;return s(this,(function(s){switch(s.label){case 0:for(i=vi(t),o=Us(),a=xs(),u=Fs(),c=0,h=n;c<h.length;c++)l=h[c],f=e.qn(l.metadata.name),l.document&&(o=o.add(f)),a=a.insert(f,e.Un(l)),u=u.insert(f,e.Qn(l.metadata.readTime));return p=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Ac(i,function(t){return Mo(Co(Di.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=s.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Tc(t,p,a,_i.min(),u).next((function(e){return p.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function xc(t,e,n){return void 0===n&&(n=Us()),o(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return[4,Ac(t,Mo(Su(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=vi(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=ra(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(Ri.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)}))}))]}}))}))}var Lc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return tu.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:ra(n.createTime)}),tu.resolve()},t.prototype.getNamedQuery=function(t,e){return tu.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Su(t.bundledQuery),readTime:ra(t.readTime)}}(e)),tu.resolve()},t}(),Pc=function(){function t(){this.Wn=new ks(Mc.Gn),this.zn=new ks(Mc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Mc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new Mc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Ki(new Di([])),r=new Mc(n,t),i=new Mc(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ki(new Di([])),n=new Mc(e,t),r=new Mc(e,t+1),i=Us();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new Mc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Mc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ki.comparator(t.key,e.key)||bi(t.ns,e.ns)},t.Hn=function(t,e){return bi(t.ns,e.ns)||Ki.comparator(t.key,e.key)},t}(),Fc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ks(Mc.Gn)}return t.prototype.checkEmpty=function(t){return tu.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new fu(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Mc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return tu.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return tu.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return tu.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return tu.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return tu.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Mc(e,0),i=new Mc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),tu.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ks(bi);return e.forEach((function(t){var e=new Mc(t,0),i=new Mc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),tu.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ki.isDocumentKey(i)||(i=i.child(""));var o=new Mc(new Ki(i),0),s=new ks(bi);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),tu.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;yi(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return tu.forEach(e.mutations,(function(i){var o=new Mc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Mc(e,0),r=this.rs.firstAfterOrEqual(n);return tu.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,tu.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Vc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Ns(Ki.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return tu.resolve(n?n.document.clone():oo.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=xs();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():oo.newInvalidDocument(t))})),tu.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=xs(),i=new Ki(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Bo(e,c)&&(r=r.insert(c.key,c.clone()))}return tu.resolve(r)},t.prototype.fs=function(t,e){return tu.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Uc(this)},t.prototype.getSize=function(t){return tu.resolve(this.size)},t}(),Uc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return n(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),tu.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(ec),qc=function(){function t(t){this.persistence=t,this.ds=new tc((function(t){return uo(t)}),co),this.lastRemoteSnapshotVersion=_i.min(),this.highestTargetId=0,this.ws=0,this._s=new Pc,this.targetCount=0,this.ys=ju.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),tu.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return tu.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return tu.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),tu.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),tu.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new ju(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,tu.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),tu.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,tu.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),tu.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return tu.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return tu.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),tu.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),tu.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),tu.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return tu.resolve(n)},t.prototype.containsKey=function(t,e){return tu.resolve(this._s.containsKey(e))},t}(),Bc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new oi(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new qc(this),this.Ut=new Cu,this.Ue=function(t,e){return new Vc(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new yu(e),this.Qe=new Lc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Fc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;hi("MemoryPersistence","Starting transaction:",t);var i=new jc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return tu.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),jc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return n(e,t),e}($a),Kc=function(){function t(t){this.persistence=t,this.As=new Pc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw di()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),tu.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),tu.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),tu.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tu.forEach(this.vs,(function(r){var i=Ki.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return tu.or([function(){return tu.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Gc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function zc(t,e){return"firestore_clients_"+t+"_"+e}function Hc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Qc(t,e){return"firestore_targets_"+t+"_"+e}Gc.UNAUTHENTICATED=new Gc(null),Gc.GOOGLE_CREDENTIALS=new Gc("google-credentials-uid"),Gc.FIRST_PARTY=new Gc("first-party-uid");var Wc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new ai(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(li("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Yc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new ai(i.error.code,i.error.message)),o?new t(e,i.state,r):(li("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Xc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Bs(),s=0;i&&s<r.activeTargetIds.length;++s)i=ji(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(li("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Jc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(li("SharedClientState","Failed to parse online state: "+e),null)},t}(),$c=function(){function t(){this.activeTargetIds=Bs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Zc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Ns(bi),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=zc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new $c),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i,o,a,u,c,h,l,f=this;return s(this,(function(s){switch(s.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=s.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(zc(this.persistenceKey,r)))&&(o=Xc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.Os;c<h.length;c++)l=h[c],this.Fs(l);return this.Os=[],this.window.addEventListener("unload",(function(){return f.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Qc(this.persistenceKey,t));if(n){var r=Yc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Qc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return hi("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){hi("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){hi("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(hi("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void li("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return o(e,void 0,void 0,(function(){var t,e,r,i,o,a;return s(this,(function(s){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(a=function(t){var e=oi.o;if(null!=t)try{var n=JSON.parse(t);yi("number"==typeof n),e=n}catch(t){li("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==oi.o&&this.sequenceNumberHandler(a);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Wc(this.currentUser,t,e,n),i=Hc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Hc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=Qc(this.persistenceKey,t),i=new Yc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Xc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Wc.Vs(new Gc(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Yc.Vs(r,e)},t.prototype.js=function(t){return Jc.Vs(t)},t.prototype.ii=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(hi("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Bs();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),th=function(){function t(){this.li=new $c,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new $c,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),eh=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),nh=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){hi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){hi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),rh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ih=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),oh=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return n(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new ii;s.listenOnce(Zr.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case $r.NO_ERROR:var e=s.getResponseJson();hi("Connection","XHR received:",JSON.stringify(e)),i(e);break;case $r.TIMEOUT:hi("Connection",'RPC "'+t+'" timed out'),o(new ai(si.DEADLINE_EXCEEDED,"Request time out"));break;case $r.HTTP_ERROR:var n=s.getStatus();if(hi("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(si).indexOf(e)>=0?e:si.UNKNOWN}(r.status);o(new ai(a,r.message))}else o(new ai(si.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ai(si.UNAVAILABLE,"Connection failed."));break;default:di()}}finally{hi("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.$i=function(t,e){var n,r=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new Qr,o=We(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(p())||"object"==typeof navigator&&"ReactNative"===navigator.product||p().indexOf("Electron/")>=0||function(){var t=p();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||p().indexOf("MSAppHost/")>=0||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");hi("Connection","Creating WebChannel: "+a,s);var u=i.createWebChannel(a,s),c=!1,h=!1,l=new ih({Ei:function(t){h?hi("Connection","Not sending because WebChannel is closed:",t):(c||(hi("Connection","Opening WebChannel transport."),u.open(),c=!0),hi("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,ri.EventType.OPEN,(function(){h||hi("Connection","WebChannel transport opened.")})),f(u,ri.EventType.CLOSE,(function(){h||(h=!0,hi("Connection","WebChannel transport closed"),l.Vi())})),f(u,ri.EventType.ERROR,(function(t){h||(h=!0,fi("Connection","WebChannel transport errored:",t),l.Vi(new ai(si.UNAVAILABLE,"The operation could not be completed")))})),f(u,ri.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];yi(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){hi("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=ws[t];if(void 0!==e)return As(e)}(o),a=i.message;void 0===s&&(s=si.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new ai(s,a)),u.close()}else hi("Connection","WebChannel received:",n),l.Si(n)}})),f(o,ti.STAT_EVENT,(function(t){t.stat===ei?hi("Connection","Detected buffering proxy"):t.stat===ni&&hi("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);hi("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return hi("RestConnection","Received: ",t),t}),(function(e){throw fi("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.5.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=rh[t];return this.Di+"/v1/"+e+":"+n},t}());function sh(){return"undefined"!=typeof window?window:null}function ah(){return"undefined"!=typeof document?document:null}function uh(t){return new Zs(t,!0)}var ch=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&hi("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),hh=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new ch(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===si.RESOURCE_EXHAUSTED?(li(e.toString()),li("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===si.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new ai(si.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return o(t,void 0,void 0,(function(){return s(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return hi("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(hi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),lh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return n(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:di()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(yi(void 0===e||"string"==typeof e),Ri.fromBase64String(e||"")):(yi(void 0===e||e instanceof Uint8Array),Ri.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?si.UNKNOWN:As(t.code);return new ai(e,t.message||"")}(a);n=new Hs(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=aa(t,r.document.name),o=ra(r.document.updateTime);var a=new ro({mapValue:{fields:r.document.fields}}),u=(s=oo.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new Gs(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=aa(t,r.document),o=r.readTime?ra(r.readTime):_i.min(),a=oo.newNoDocument(i,o),s=r.removedTargetIds||[],n=new Gs([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=aa(t,r.document),o=r.removedTargetIds||[],n=new Gs([],o,i,null);else{if(!("filter"in e))return di();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Ts(r),o=h.targetId,n=new zs(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return _i.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?_i.min():e.readTime?ra(e.readTime):_i.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=ha(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=ho(r)?{documents:va(t,r)}:{query:ma(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ea(t,e.resumeToken):e.snapshotVersion.compareTo(_i.min())>0&&(n.readTime=ta(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return di()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=ha(this.R),e.removeTarget=t,this.cr(e)},e}(hh),fh=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return n(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(yi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(yi(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?ra(t.updateTime):ra(e);return n.isEqual(_i.min())&&(n=ra(e)),new ss(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=ra(t.commitTime);return this.listener.Tr(n,e)}return yi(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=ha(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return da(e.R,t)}))};this.cr(n)},e}(hh),ph=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return n(e,t),e.prototype.br=function(){if(this.Rr)throw new ai(si.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===si.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ai(si.UNKNOWN,t.toString())}))},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw"FirebaseError"===t.name?(t.code===si.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ai(si.UNKNOWN,t.toString())}))},e.prototype.terminate=function(){this.Rr=!0},e}((function(){})),dh=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(li(e),this.Vr=!1):hi("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),yh=function(t,e,n,r,i){var a=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return o(a,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return Th(this)?(hi("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return(e=vi(t)).$r.add(4),[4,mh(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,vh(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new dh(n,r)};function vh(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:if(!Th(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function mh(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function gh(t,e){var n=vi(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),_h(n)?Eh(n):Uh(n).er()&&wh(n,e))}function bh(t,e){var n=vi(t),r=Uh(n);n.Or.delete(e),r.er()&&Ih(n,e),0===n.Or.size&&(r.er()?r.ir():Th(n)&&n.Br.set("Unknown"))}function wh(t,e){t.qr.U(e.targetId),Uh(t).mr(e)}function Ih(t,e){t.qr.U(e),Uh(t).yr(e)}function Eh(t){t.qr=new Ws({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Uh(t).start(),t.Br.Sr()}function _h(t){return Th(t)&&!Uh(t).tr()&&t.Or.size>0}function Th(t){return 0===vi(t).$r.size}function Sh(t){t.qr=void 0}function Ah(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return t.Or.forEach((function(e,n){wh(t,e)})),[2]}))}))}function Nh(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){return Sh(t),_h(t)?(t.Br.Nr(e),Eh(t)):t.Br.set("Unknown"),[2]}))}))}function Dh(t,e,n){return o(this,void 0,void 0,(function(){var r,i,a;return s(this,(function(u){switch(u.label){case 0:if(t.Br.set("Online"),!(e instanceof Hs&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o;return s(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Or.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return r=u.sent(),hi("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Ch(t,r)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Gs?t.qr.X(e):e instanceof zs?t.qr.rt(e):t.qr.et(e),n.isEqual(_i.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,Ec(t.localStore)];case 8:return i=u.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(Ri.EMPTY_BYTE_STRING,n.snapshotVersion)),Ih(t,e);var r=new du(n.target,e,1,n.sequenceNumber);wh(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return hi("RemoteStore","Failed to raise snapshot:",a=u.sent()),[4,Ch(t,a)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function Ch(t,e,n){return o(this,void 0,void 0,(function(){var r=this;return s(this,(function(i){switch(i.label){case 0:if(!ou(e))throw e;return t.$r.add(1),[4,mh(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Ec(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return o(r,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return hi("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,vh(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function kh(t,e){return e().catch((function(n){return Ch(t,n,e)}))}function Oh(t){return o(this,void 0,void 0,(function(){var e,n,r,i,o;return s(this,(function(s){switch(s.label){case 0:e=vi(t),n=qh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Th(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Sc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=qh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Ch(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Rh(e)&&xh(e),[2]}}))}))}function Rh(t){return Th(t)&&!qh(t).tr()&&t.kr.length>0}function xh(t){qh(t).start()}function Lh(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){return qh(t).Ar(),[2]}))}))}function Ph(t){return o(this,void 0,void 0,(function(){var e,n,r,i;return s(this,(function(o){for(e=qh(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function Mh(t,e,n){return o(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=pu.from(r,e,n),[4,kh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,Oh(t)];case 2:return o.sent(),[2]}}))}))}function Fh(t,e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return e&&qh(t).pr?[4,function(t,e){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return Ss(r=e.code)&&r!==si.ABORTED?(n=t.kr.shift(),qh(t).sr(),[4,kh(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,Oh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Rh(t)&&xh(t),[2]}}))}))}function Vh(t,e){return o(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return n=vi(t),e?(n.$r.delete(2),[4,vh(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,mh(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Uh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=vi(t);return r.br(),new lh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ah.bind(null,t),Ri:Nh.bind(null,t),_r:Dh.bind(null,t)}),t.Mr.push((function(n){return o(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),_h(t)?Eh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Sh(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function qh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=vi(t);return r.br(),new fh(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Lh.bind(null,t),Ri:Fh.bind(null,t),Ir:Ph.bind(null,t),Tr:Mh.bind(null,t)}),t.Mr.push((function(n){return o(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,Oh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(hi("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qr}var Bh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Za,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ai(si.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function jh(t,e){if(li("AsyncQueue",e+": "+t),ou(t))return new ai(si.UNAVAILABLE,e+": "+t);throw t}var Kh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ki.comparator(e.key,n.key)}:function(t,e){return Ki.comparator(t.key,e.key)},this.keyedMap=Ps(),this.sortedSet=new Ns(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Gh=function(){function t(){this.Kr=new Ns(Ki.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):di():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),zh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Kh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Hh=function(){this.Wr=void 0,this.listeners=[]},Qh=function(){this.queries=new tc((function(t){return Uo(t)}),Vo),this.onlineState="Unknown",this.Gr=new Set};function Wh(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u,c;return s(this,(function(s){switch(s.label){case 0:if(n=vi(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new Hh),!i)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),a=o,[4,n.onListen(r)];case 2:return a.Wr=s.sent(),[3,4];case 3:return u=s.sent(),c=jh(u,"Initialization of query '"+qo(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&$h(n),[2]}}))}))}function Yh(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a;return s(this,(function(s){return n=vi(t),r=e.query,i=!1,(o=n.queries.get(r))&&(a=o.listeners.indexOf(e))>=0&&(o.listeners.splice(a,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Xh(t,e){for(var n=vi(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&$h(n)}function Jh(t,e,n){var r=vi(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function $h(t){t.Gr.forEach((function(t){t.next()}))}var Zh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new zh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=zh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),tl=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),el=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return aa(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?pa(this.R,t.document,!1):oo.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return ra(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new el(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Us()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return o(this,void 0,void 0,(function(){var t,e,n,r,i;return s(this,(function(o){switch(o.label){case 0:return[4,Rc(this.localStore,new el(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,xc(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new dc(Object.assign({},this.progress),t))]}}))}))}}();var nl=function(t){this.key=t},rl=function(t){this.key=t},il=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Us(),this.mutatedKeys=Us(),this.lo=jo(t),this.fo=new Kh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Gh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=ko(this.query)&&i.size===this.query.limit?i.last():null,c=Oo(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Bo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),p=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data.isEqual(l.data)?f!==p&&(r.track({type:3,doc:l}),d=!0):n.yo(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),ko(this.query)||Oo(this.query))for(;s.size>this.query.limit;){var h=ko(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return di()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new zh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Gh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Us(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new rl(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new nl(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Us();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return zh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),ol=function(t,e,n){this.query=t,this.targetId=e,this.view=n},sl=function(t){this.key=t,this.bo=!1},al=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new tc((function(t){return Uo(t)}),Vo),this.Vo=new Map,this.So=new Set,this.Do=new Ns(Ki.comparator),this.Co=new Map,this.No=new Pc,this.xo={},this.Fo=new Map,this.ko=ju.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function ul(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u;return s(this,(function(s){switch(s.label){case 0:return n=Fl(t),(o=n.Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Ac(n.localStore,Mo(e))];case 2:return a=s.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),r=a.targetId,[4,cl(n,e,r,"current"===u)];case 3:i=s.sent(),n.isPrimaryClient&&gh(n.remoteStore,a),s.label=4;case 4:return[2,i]}}))}))}function cl(t,e,n,r){return o(this,void 0,void 0,(function(){var i,a,u,c,h,l;return s(this,(function(f){switch(f.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return o(this,void 0,void 0,(function(){var i,o,a;return s(this,(function(s){switch(s.label){case 0:return(i=e.view._o(n)).Nn?[4,Dc(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(El(t,e.targetId,a.To),a.snapshot)]}}))}))}(t,e,n,r)},[4,Dc(t.localStore,e,!0)];case 1:return i=f.sent(),a=new il(e,i.Bn),u=a._o(i.documents),c=Ks.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),h=a.applyChanges(u,t.isPrimaryClient,c),El(t,n,h.To),l=new ol(e,n,a),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),h.snapshot)]}}))}))}function hl(t,e){return o(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(o){switch(o.label){case 0:return n=vi(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Vo(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Nc(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),bh(n.remoteStore,r.targetId),wl(n,r.targetId)})).catch(Qu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return wl(n,r.targetId),[4,Nc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function ll(t,e,n){return o(this,void 0,void 0,(function(){var r,i,o,a;return s(this,(function(s){switch(s.label){case 0:r=Vl(t),s.label=1;case 1:return s.trys.push([1,5,,6]),[4,function(t,e){var n,r=vi(t),i=Ei.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Us());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=fs(c,n.get(c.key));null!=h&&s.push(new vs(c.key,h,io(h.toProto().mapValue),as.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=s.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Ns(bi)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Sl(r,i.changes)];case 3:return s.sent(),[4,Oh(r.remoteStore)];case 4:return s.sent(),[3,6];case 5:return o=s.sent(),a=jh(o,"Failed to persist write"),n.reject(a),[3,6];case 6:return[2]}}))}))}function fl(t,e){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:n=vi(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,_c(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(yi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?yi(r.bo):t.removedDocuments.size>0&&(yi(r.bo),r.bo=!1))})),[4,Sl(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Qu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function pl(t,e,n){var r=vi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=vi(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&$h(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function dl(t,e,n){return o(this,void 0,void 0,(function(){var r,i,o,a,u,c;return s(this,(function(s){switch(s.label){case 0:return(r=vi(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(a=(a=new Ns(Ki.comparator)).insert(o,oo.newNoDocument(o,_i.min())),u=Us().add(o),c=new js(_i.min(),new Map,new ks(bi),a,u),[4,fl(r,c)]):[3,2];case 1:return s.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Tl(r),[3,4];case 2:return[4,Nc(r.localStore,e,!1).then((function(){return wl(r,e,n)})).catch(Qu)];case 3:s.sent(),s.label=4;case 4:return[2]}}))}))}function yl(t,e){return o(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(o){switch(o.label){case 0:n=vi(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Ic(n.localStore,e)];case 2:return i=o.sent(),bl(n,r,null),gl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Sl(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Qu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function vl(t,e,n){return o(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:r=vi(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=vi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return yi(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),bl(r,e,n),gl(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Sl(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Qu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function ml(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a;return s(this,(function(s){switch(s.label){case 0:Th((n=vi(t)).remoteStore)||hi("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,function(t){var e=vi(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=s.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=s.sent(),a=jh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(a),[3,4];case 4:return[2]}}))}))}function gl(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function bl(t,e,n){var r=vi(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function wl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Il(t,e)}))}function Il(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(bh(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Tl(t))}function El(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof nl?(t.No.addReference(o.key,e),_l(t,o)):o instanceof rl?(hi("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Il(t,o.key)):di()}}function _l(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(hi("SyncEngine","New document in limbo: "+n),t.So.add(r),Tl(t))}function Tl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ki(Di.fromString(e)),r=t.ko.next();t.Co.set(r,new sl(n)),t.Do=t.Do.insert(n,r),gh(t.remoteStore,new du(Mo(Co(n.path)),r,2,oi.o))}}function Sl(t,e,n){return o(this,void 0,void 0,(function(){var r,i,a,u;return s(this,(function(c){switch(c.label){case 0:return r=vi(t),i=[],a=[],u=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,o){u.push(r.$o(o,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(o.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=vc.Pn(o.targetId,t);a.push(e)}})))})),[4,Promise.all(u)]);case 1:return c.sent(),r.vo._r(i),[4,function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u,c,h,l;return s(this,(function(s){switch(s.label){case 0:n=vi(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return tu.forEach(e,(function(e){return tu.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return tu.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return s.sent(),[3,4];case 3:if(!ou(r=s.sent()))throw r;return hi("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=o[i],u=a.targetId,a.fromCache||(c=n.Fn.get(u),h=c.snapshotVersion,l=c.withLastLimboFreeSnapshotVersion(h),n.Fn=n.Fn.insert(u,l));return[2]}}))}))}(r.localStore,a)];case 2:c.sent(),c.label=3;case 3:return[2]}}))}))}function Al(t,e){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return(n=vi(t)).currentUser.isEqual(e)?[3,3]:(hi("SyncEngine","User change. New user:",e.toKey()),[4,wc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new ai(si.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Sl(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Nl(t,e){var n=vi(t),r=n.Co.get(e);if(r&&r.bo)return Us().add(r.key);var i=Us(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Dl(t,e){return o(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(o){switch(o.label){case 0:return[4,Dc((n=vi(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&El(n,e.targetId,i.To),i)]}}))}))}function Cl(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){return[2,kc((e=vi(t)).localStore).then((function(t){return Sl(e,t)}))]}))}))}function kl(t,e,n,r){return o(this,void 0,void 0,(function(){var i,o;return s(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=vi(t),r=vi(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):tu.resolve(null)}))}))}((i=vi(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Oh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(bl(i,e,r||null),gl(i,e),function(t,e){vi(vi(t)._n).Gt(e)}(i.localStore,e)):di(),s.label=4;case 4:return[4,Sl(i,o)];case 5:return s.sent(),[3,7];case 6:hi("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Ol(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u,c,h;return s(this,(function(s){switch(s.label){case 0:return Fl(n=vi(t)),Vl(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Rl(n,r.toArray())]);case 1:return i=s.sent(),n.Oo=!0,[4,Vh(n.remoteStore,!0)];case 2:for(s.sent(),o=0,a=i;o<a.length;o++)u=a[o],gh(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then((function(){return wl(n,e),Nc(n.localStore,e,!0)})),bh(n.remoteStore,e)})),[4,h]);case 4:return s.sent(),[4,Rl(n,c)];case 5:return s.sent(),function(t){var e=vi(t);e.Co.forEach((function(t,n){bh(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Ns(Ki.comparator)}(n),n.Oo=!1,[4,Vh(n.remoteStore,!1)];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))}function Rl(t,e,n){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u,c,h,l,f,p,d,y,v;return s(this,(function(s){switch(s.label){case 0:n=vi(t),r=[],i=[],o=0,a=e,s.label=1;case 1:return o<a.length?(u=a[o],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,Ac(n.localStore,Mo(h[0]))]:[3,7]):[3,13];case 2:c=s.sent(),l=0,f=h,s.label=3;case 3:return l<f.length?(p=f[l],d=n.Po.get(p),[4,Dl(n,d)]):[3,6];case 4:(y=s.sent()).snapshot&&i.push(y.snapshot),s.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,Cc(n.localStore,u)];case 8:return v=s.sent(),[4,Ac(n.localStore,v)];case 9:return c=s.sent(),[4,cl(n,xl(v),u,!1)];case 10:s.sent(),s.label=11;case 11:r.push(c),s.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function xl(t){return Do(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ll(t){var e=vi(t);return vi(vi(e.localStore).persistence).fn()}function Pl(t,e,n,r){return o(this,void 0,void 0,(function(){var i,o,a;return s(this,(function(s){switch(s.label){case 0:return(i=vi(t)).Oo?(hi("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,kc(i.localStore)];case 3:return o=s.sent(),a=js.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Sl(i,o,a)];case 4:return s.sent(),[3,8];case 5:return[4,Nc(i.localStore,e,!0)];case 6:return s.sent(),wl(i,e,r),[3,8];case 7:di(),s.label=8;case 8:return[2]}}))}))}function Ml(t,e,n){return o(this,void 0,void 0,(function(){var r,i,o,a,u,c,h,l,f,p;return s(this,(function(d){switch(d.label){case 0:if(!(r=Fl(t)).Oo)return[3,10];i=0,o=e,d.label=1;case 1:return i<o.length?(a=o[i],r.Vo.has(a)?(hi("SyncEngine","Adding an already active target "+a),[3,5]):[4,Cc(r.localStore,a)]):[3,6];case 2:return u=d.sent(),[4,Ac(r.localStore,u)];case 3:return c=d.sent(),[4,cl(r,xl(u),c.targetId,!1)];case 4:d.sent(),gh(r.remoteStore,c),d.label=5;case 5:return i++,[3,1];case 6:h=function(t){return s(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Nc(r.localStore,t,!1).then((function(){bh(r.remoteStore,t),wl(r,t)})).catch(Qu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},l=0,f=n,d.label=7;case 7:return l<f.length?(p=f[l],[5,h(p)]):[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function Fl(t){var e=vi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=fl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=dl.bind(null,e),e.vo._r=Xh.bind(null,e.eventManager),e.vo.Mo=Jh.bind(null,e.eventManager),e}function Vl(t){var e=vi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=yl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vl.bind(null,e),e}var Ul=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.R=uh(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return bc(this.persistence,new mc,t.initialUser,this.R)},t.prototype.qo=function(t){return new Bc(Kc.bs,this.R)},t.prototype.Bo=function(t){return new th},t.prototype.terminate=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),ql=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return n(e,t),e.prototype.initialize=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Oc(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Vl(this.Ko.syncEngine)];case 4:return n.sent(),[4,Oh(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Qo=function(t){return bc(this.persistence,new mc,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Xu(e,t.asyncQueue)},e.prototype.qo=function(t){var e=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Lu.withCacheSize(this.cacheSizeBytes):Lu.DEFAULT;return new hc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,sh(),ah(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new th},e}(Ul),Bl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return n(e,t),e.prototype.initialize=function(e){return o(this,void 0,void 0,(function(){var n,r=this;return s(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Zc?(this.sharedClientState.syncEngine={ui:kl.bind(null,n),ai:Pl.bind(null,n),hi:Ml.bind(null,n),fn:Ll.bind(null,n),ci:Cl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return o(r,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,Ol(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=sh();if(!Zc.yt(e))throw new ai(si.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=pc(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Zc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(ql),jl=function(){function t(){}return t.prototype.initialize=function(t,e){return o(this,void 0,void 0,(function(){var n=this;return s(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return pl(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Al.bind(null,this.syncEngine),[4,Vh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new Qh},t.prototype.createDatastore=function(t){var e,n=uh(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new oh(e));return function(t,e,n){return new ph(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return pl(s.syncEngine,t,0)},o=nh.yt()?new nh:new eh,new yh(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new al(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=vi(t),hi("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,mh(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}(),Kl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),Gl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Za,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return o(this,void 0,void 0,(function(){var t,e,n,r;return s(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new tl(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return o(this,void 0,void 0,(function(){var t,e;return s(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return o(this,void 0,void 0,(function(){var e,n=this;return s(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new ai(si.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return o(this,void 0,void 0,(function(){var n,r,i,o,a,u;return s(this,(function(s){switch(s.label){case 0:return n=vi(t),r=ha(n.R)+"/documents",i={documents:e.map((function(t){return sa(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=s.sent(),a=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){yi(!!e.found),e.found.name,e.found.updateTime;var n=aa(t,e.found.name),r=ra(e.found.updateTime),i=new ro({mapValue:{fields:e.found.fields}});return oo.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){yi(!!e.missing),yi(!!e.readTime);var n=aa(t,e.missing),r=ra(e.readTime);return oo.newNoDocument(n,r)}(t,e):di()}(n.R,t);a.set(e.key.toString(),e)})),u=[],[2,(e.forEach((function(t){var e=a.get(t.toString());yi(!!e),u.push(e)})),u)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Es(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return o(this,void 0,void 0,(function(){var t,e=this;return s(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Ki.fromPath(n);e.mutations.push(new _s(r,e.precondition(r)))})),[4,function(t,e){return o(this,void 0,void 0,(function(){var n,r,i;return s(this,(function(o){switch(o.label){case 0:return n=vi(t),r=ha(n.R)+"/documents",i={writes:e.map((function(t){return da(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw di();e=_i.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new ai(si.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?as.updateTime(e):as.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(_i.min()))throw new ai(si.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return as.updateTime(e)}return as.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),zl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new ch(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return o(t,void 0,void 0,(function(){var t,e,n=this;return s(this,(function(r){return t=new Gl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!qi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ss(e)}return!1},t}(),Hl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Gc.UNAUTHENTICATED,this.clientId=gi.u(),this.credentialListener=function(){},this.receivedInitialUser=new Za,this.credentials.setChangeListener((function(t){hi("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new ai(si.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Za;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return o(t,void 0,void 0,(function(){var t,n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=jh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function Ql(t,e){return o(this,void 0,void 0,(function(){var n,r,i=this;return s(this,(function(a){switch(a.label){case 0:return t.asyncQueue.verifyOperationInProgress(),hi("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=a.sent(),[4,e.initialize(n)];case 2:return a.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return o(i,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,wc(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function Wl(t,e){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Yl(t)];case 1:return n=i.sent(),hi("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return o(this,void 0,void 0,(function(){var n,r;return s(this,(function(i){switch(i.label){case 0:return(n=vi(t)).asyncQueue.verifyOperationInProgress(),hi("RemoteStore","RemoteStore received new credentials"),r=Th(n),n.$r.add(3),[4,mh(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,vh(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function Yl(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(hi("FirestoreClient","Using default OfflineComponentProvider"),[4,Ql(t,new Ul)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function Xl(t){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(hi("FirestoreClient","Using default OnlineComponentProvider"),[4,Wl(t,new jl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function Jl(t){return Yl(t).then((function(t){return t.persistence}))}function $l(t){return Yl(t).then((function(t){return t.localStore}))}function Zl(t){return Xl(t).then((function(t){return t.remoteStore}))}function tf(t){return Xl(t).then((function(t){return t.syncEngine}))}function ef(t){return o(this,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return[4,Xl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=ul.bind(null,e.syncEngine),n.onUnlisten=hl.bind(null,e.syncEngine),n)]}}))}))}function nf(t,e,n){var r=this;void 0===n&&(n={});var i=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(r,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Kl({next:function(o){e.enqueueAndForget((function(){return Yh(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new ai(si.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new ai(si.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Zh(Co(n.path),o,{includeMetadataChanges:!0,so:!0});return Wh(t,s)},[4,ef(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function rf(t,e,n){var r=this;void 0===n&&(n={});var i=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(r,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Kl({next:function(n){e.enqueueAndForget((function(){return Yh(t,s)})),n.fromCache&&"server"===r.source?i.reject(new ai(si.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Zh(n,o,{includeMetadataChanges:!0,so:!0});return Wh(t,s)},[4,ef(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var of=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},sf=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),af=new Map,uf=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},cf=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(Gc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),hf=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(this.token.user)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),lf=function(){function t(t){var e=this;this.oc=null,this.currentUser=Gc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(hi("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(yi("string"==typeof n.accessToken),new uf(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return yi(null===t||"string"==typeof t),new Gc(t)},t}(),ff=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=Gc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),pf=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new ff(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(Gc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function df(t,e,n){if(!n)throw new ai(si.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function yf(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new ai(si.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function vf(t,e,n,r){if(!0===e&&!0===r)throw new ai(si.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function mf(t){if(!Ki.isDocumentKey(t))throw new ai(si.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function gf(t){if(Ki.isDocumentKey(t))throw new ai(si.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function bf(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":di()}function wf(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ai(si.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=bf(t);throw new ai(si.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function If(t,e){if(e<=0)throw new ai(si.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ef=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new ai(si.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ai(si.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,vf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),_f=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ef({}),this._settingsFrozen=!1,t instanceof sf?(this._databaseId=t,this._credentials=new cf):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ai(si.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sf(t.options.projectId)}(t),this._credentials=new lf(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new ai(si.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new ai(si.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ef(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new cf;switch(t.type){case"gapi":var e=t.client;return yi(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new pf(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new ai(si.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=af.get(this))&&(hi("ComponentProvider","Removing Datastore"),af.delete(this),t.terminate()),Promise.resolve();var t},t}(),Tf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Af(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Sf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Af=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Co(r))||this)._path=r,i.type="collection",i}return n(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Tf(this.firestore,null,new Ki(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Sf);function Nf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),df("collection","path",e),t instanceof _f)return gf(n=Di.fromString.apply(Di,c([e],r))),new Af(t,null,n);if(!(t instanceof Tf||t instanceof Af))throw new ai(si.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gf(n=Di.fromString.apply(Di,c([t.path],r)).child(Di.fromString(e))),new Af(t.firestore,null,n)}function Df(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=_(t),1===arguments.length&&(e=gi.u()),df("doc","path",e),t instanceof _f)return mf(n=Di.fromString.apply(Di,c([e],r))),new Tf(t,null,new Ki(n));if(!(t instanceof Tf||t instanceof Af))throw new ai(si.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return mf(n=t._path.child(Di.fromString.apply(Di,c([e],r)))),new Tf(t.firestore,t instanceof Af?t.converter:null,new Ki(n))}function Cf(t,e){return t=_(t),e=_(e),(t instanceof Tf||t instanceof Af)&&(e instanceof Tf||e instanceof Af)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function kf(t,e){return t=_(t),e=_(e),t instanceof Sf&&e instanceof Sf&&t.firestore===e.firestore&&Vo(t._query,e._query)&&t.converter===e.converter}var Of=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new ch(this,"async_queue_retry"),this.Ec=function(){var e=ah();e&&hi("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=ah();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=ah();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return o(this,void 0,void 0,(function(){var t,e=this;return s(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!ou(t=n.sent()))throw t;return hi("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,li("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=Bh.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&di()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return o(this,void 0,void 0,(function(){var t;return s(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function Rf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Za,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var xf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Of,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return n(e,t),e.prototype._terminate=function(){return this._firestoreClient||Pf(this),this._firestoreClient.terminate()},e}(_f);function Lf(t){return t._firestoreClient||Pf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Pf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new of(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Hl(t._credentials,t._queue,r)}function Mf(t,e,n){var r=this,i=new Za;return t.asyncQueue.enqueue((function(){return o(r,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Ql(t,n)];case 1:return o.sent(),[4,Wl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===si.FAILED_PRECONDITION||t.code===si.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Ff(t){if(t._initialized||t._terminated)throw new ai(si.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Vf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new ai(si.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ki(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Uf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Ri.fromBase64String(e))}catch(e){throw new ai(si.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Ri.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),qf=function(t){this._methodName=t},Bf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new ai(si.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ai(si.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return bi(this._lat,t._lat)||bi(this._long,t._long)},t}(),jf=/^__.*__$/,Kf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new vs(t,this.data,this.fieldMask,e,this.fieldTransforms):new ys(t,this.data,e,this.fieldTransforms)},t}(),Gf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new vs(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function zf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw di()}}var Hf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return fp(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(zf(this.Dc)&&jf.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),Qf=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||uh(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new Hf({Dc:t,methodName:e,Lc:n,path:ki.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Wf(t){var e=t._freezeSettings(),n=uh(t._databaseId);return new Qf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Yf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);up("Data must be an object, but it was:",s,r);var a,u,c=sp(r,s);if(o.merge)a=new Oi(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var p=cp(e,f[l],n);if(!s.contains(p))throw new ai(si.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");pp(h,p)||h.push(p)}a=new Oi(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Kf(new ro(c),a,u)}var Xf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(qf);function Jf(t,e,n){return new Hf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var $f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._toFieldTransform=function(t){return new os(t.path,new Jo)},e.prototype.isEqual=function(t){return t instanceof e},e}(qf),Zf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=Jf(this,t,!0),n=this.qc.map((function(t){return op(t,e)})),r=new $o(n);return new os(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qf),tp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=Jf(this,t,!0),n=this.qc.map((function(t){return op(t,e)})),r=new ts(n);return new os(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(qf),ep=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return n(e,t),e.prototype._toFieldTransform=function(t){var e=new ns(t.R,Ho(t.R,this.Uc));return new os(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(qf);function np(t,e,n,r){var i=t.Bc(1,e,n);up("Data must be an object, but it was:",i,r);var o=[],s=ro.empty();Si(r,(function(t,r){var a=lp(e,t,n);r=_(r);var u=i.kc(a);if(r instanceof Xf)o.push(a);else{var c=op(r,u);null!=c&&(o.push(a),s.set(a,c))}}));var a=new Oi(o);return new Gf(s,a,i.fieldTransforms)}function rp(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[cp(e,r,n)],u=[i];if(o.length%2!=0)throw new ai(si.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(cp(e,o[c])),u.push(o[c+1]);for(var h=[],l=ro.empty(),f=a.length-1;f>=0;--f)if(!pp(h,a[f])){var p=a[f],d=u[f];d=_(d);var y=s.kc(p);if(d instanceof Xf)h.push(p);else{var v=op(d,y);null!=v&&(h.push(p),l.set(p,v))}}var m=new Oi(h);return new Gf(l,m,s.fieldTransforms)}function ip(t,e,n,r){return void 0===r&&(r=!1),op(n,t.Bc(r?4:3,e))}function op(t,e){if(ap(t=_(t)))return up("Unsupported field value:",e,t),sp(t,e);if(t instanceof qf)return function(t,e){if(!zf(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=op(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=_(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ho(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ei.fromDate(t);return{timestampValue:ta(e.R,n)}}if(t instanceof Ei)return n=new Ei(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ta(e.R,n)};if(t instanceof Bf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Uf)return{bytesValue:ea(e.R,t._byteString)};if(t instanceof Tf){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ia(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+bf(t))}(t,e)}function sp(t,e){var n={};return Ai(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Si(t,(function(t,r){var i=op(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function ap(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ei||t instanceof Bf||t instanceof Uf||t instanceof Tf||t instanceof qf)}function up(t,e,n){if(!ap(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=bf(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}}function cp(t,e,n){if((e=_(e))instanceof Vf)return e._internalPath;if("string"==typeof e)return lp(t,e);throw fp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var hp=new RegExp("[~\\*/\\[\\]]");function lp(t,e,n){if(e.search(hp)>=0)throw fp("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Vf.bind.apply(Vf,c([void 0],e.split(".")))))._internalPath}catch(r){throw fp("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function fp(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new ai(si.INVALID_ARGUMENT,(a+=". ")+t+u)}function pp(t,e){return t.some((function(t){return t.isEqual(e)}))}var dp=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Tf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new yp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(vp("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),yp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(dp);function vp(t,e){return"string"==typeof e?lp(t,e):e instanceof Vf?e._internalPath:e._delegate._internalPath}var mp=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),gp=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return n(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new bp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(vp("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(dp),bp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(gp),wp=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new mp(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new bp(n._firestore,n._userDataWriter,r.key,r,new mp(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ai(si.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new bp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new mp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new bp(t._firestore,t._userDataWriter,e.doc.key,e.doc,new mp(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Ip(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Ip(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return di()}}function Ep(t,e){return t instanceof gp&&e instanceof gp?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof wp&&e instanceof wp&&t._firestore===e._firestore&&kf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function _p(t){if(Oo(t)&&0===t.explicitOrderBy.length)throw new ai(si.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Tp=function(){};function Sp(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Ap=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return n(e,t),e.prototype._apply=function(t){var e=Wf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){xp(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Rp(r,t,l))}a={arrayValue:{values:u}}}else a=Rp(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||xp(s,o),a=ip(n,"where",s,"in"===o||"not-in"===o);var f=lo.create(i,o,a);return function(t,e){if(e.g()){var n=xo(t);if(null!==n&&!n.isEqual(e.field))throw new ai(si.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Ro(t);null!==r&&Lp(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new ai(si.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new ai(si.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Sf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Tp),Np=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return n(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new ai(si.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new ai(si.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new _o(e,n);return function(t,e){if(null===Ro(t)){var n=xo(t);null!==n&&Lp(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Sf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new No(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Tp),Dp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return n(e,t),e.prototype._apply=function(t){return new Sf(t.firestore,t.converter,Fo(t._query,this.Gc,this.zc))},e}(Tp),Cp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return n(e,t),e.prototype._apply=function(t){var e=Op(t,this.type,this.Hc,this.Jc);return new Sf(t.firestore,t.converter,function(t,e){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Tp),kp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return n(e,t),e.prototype._apply=function(t){var e=Op(t,this.type,this.Hc,this.Jc);return new Sf(t.firestore,t.converter,function(t,e){return new No(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Tp);function Op(t,e,n,r){if(n[0]=_(n[0]),n[0]instanceof dp)return function(t,e,n,r,i){if(!r)throw new ai(si.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=Po(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ji(e,r.key));else{var c=r.data.field(u.field);if(Fi(c))throw new ai(si.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new ai(si.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Io(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Wf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new ai(si.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new ai(si.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Lo(t)&&-1!==c.indexOf("/"))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Di.fromString(c));if(!Ki.isDocumentKey(h))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ki(h);a.push(Ji(e,l))}else{var f=ip(n,r,c);a.push(f)}}return new Io(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Rp(t,e,n){if("string"==typeof(n=_(n))){if(""===n)throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Lo(e)&&-1!==n.indexOf("/"))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Di.fromString(n));if(!Ki.isDocumentKey(r))throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ji(t,new Ki(r))}if(n instanceof Tf)return Ji(t,n._key);throw new ai(si.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+bf(n)+".")}function xp(t,e){if(!Array.isArray(t)||0===t.length)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new ai(si.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Lp(t,e,n){if(!n.isEqual(e))throw new ai(si.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Pp=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Gi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Mi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw di()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Si(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Bf(Pi(t.latitude),Pi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Vi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ui(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Li(t);return new Ei(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Di.fromString(t);yi(Ca(n));var r=new sf(n.get(1),n.get(3)),i=new Ki(n.popFirst(5));return r.isEqual(e)||li("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Mp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Fp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new Uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tf(this.firestore,null,e)},e}(Pp),Vp=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Wf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Up(t,this._firestore),i=Mp(r.converter,e,n),o=Yf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,as.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Up(t,this._firestore);return o="string"==typeof(e=_(e))||e instanceof Vf?rp(this._dataReader,"WriteBatch.update",s._key,e,n,r):np(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,as.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Up(t,this._firestore);return this._mutations=this._mutations.concat(new Es(e._key,as.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new ai(si.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Up(t,e){if((t=_(t)).firestore!==e)throw new ai(si.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var qp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new Uf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tf(this.firestore,null,e)},e}(Pp);function Bp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=wf(t,Tf);var o=wf(t.firestore,xf),s=Wf(o);return Kp(o,[("string"==typeof(e=_(e))||e instanceof Vf?rp(s,"updateDoc",t._key,e,n,r):np(s,"updateDoc",t._key,e)).toMutation(t._key,as.exists(!0))])}function jp(t){for(var e,n,r,i=[],a=1;a<arguments.length;a++)i[a-1]=arguments[a];t=_(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof i[c]||Rf(i[c])||(u=i[c],c++);var h,l,f,p={includeMetadataChanges:u.includeMetadataChanges};if(Rf(i[c])){var d=i[c];i[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),i[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),i[c+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof Tf)l=wf(t.firestore,xf),f=Co(t._key.path),h={next:function(e){i[c]&&i[c](Gp(l,t,e))},error:i[c+1],complete:i[c+2]};else{var y=wf(t,Sf);l=wf(y.firestore,xf),f=y._query;var v=new qp(l);h={next:function(t){i[c]&&i[c](new wp(l,v,y,t))},error:i[c+1],complete:i[c+2]},_p(t._query)}return function(t,e,n,r){var i=this,a=new Kl(r),u=new Zh(e,a,n);return t.asyncQueue.enqueueAndForget((function(){return o(i,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=Wh,[4,ef(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))})),function(){a.Wo(),t.asyncQueue.enqueueAndForget((function(){return o(i,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=Yh,[4,ef(t)];case 1:return[2,e.apply(void 0,[n.sent(),u])]}}))}))}))}}(Lf(l),f,p,h)}function Kp(t,e){return function(t,e){var n=this,r=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=ll,[4,tf(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Lf(t),e)}function Gp(t,e,n){var r=n.docs.get(e._key),i=new qp(t);return new gp(t,i,e._key,r,new mp(n.hasPendingWrites,n.fromCache),e.converter)}var zp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return n(e,t),e.prototype.get=function(e){var n=this,r=Up(e,this._firestore),i=new qp(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new gp(n._firestore,i,r._key,t._document,new mp(!1,!1),r.converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Wf(t)}return t.prototype.get=function(t){var e=this,n=Up(t,this._firestore),r=new Fp(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return di();var i=t[0];if(i.isFoundDocument())return new dp(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new dp(e._firestore,r,n._key,null,n.converter);throw di()}))},t.prototype.set=function(t,e,n){var r=Up(t,this._firestore),i=Mp(r.converter,e,n),o=Yf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Up(t,this._firestore);return o="string"==typeof(e=_(e))||e instanceof Vf?rp(this._dataReader,"Transaction.update",s._key,e,n,r):np(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Up(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Hp(){if("undefined"==typeof Uint8Array)throw new ai(si.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Qp(){if("undefined"==typeof atob)throw new ai(si.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Wp=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Qp(),new t(Uf.fromBase64String(e))},t.fromUint8Array=function(e){return Hp(),new t(Uf.fromUint8Array(e))},t.prototype.toBase64=function(){return Qp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Hp(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Yp=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Ff(t=wf(t,xf));var n=Lf(t),r=t._freezeSettings(),i=new jl;return Mf(n,i,new ql(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Ff(t=wf(t,xf));var e=Lf(t),n=t._freezeSettings(),r=new jl;return Mf(e,r,new Bl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new ai(si.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Za;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return o(e,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return nu.yt()?(e=t+"main",[4,nu.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(pc(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),Xp=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof sf||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var o=(t=wf(t,_f))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&fi("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n="demo-project",r=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=i({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},t);return[h.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),h.encodeString(JSON.stringify(s),!1),""].join(".")}(r.mockUserToken),a=r.mockUserToken.sub||r.mockUserToken.user_id;if(!a)throw new ai(si.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new hf(new uf(s,new Gc(a)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return o(e,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return[4,Jl(t)];case 1:return e=r.sent(),[4,Zl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=vi(t);return e.$r.delete(0),vh(e)}(n))]}}))}))}))}(Lf(wf(this._delegate,xf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return o(e,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return[4,Jl(t)];case 1:return e=r.sent(),[4,Zl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return o(this,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return(e=vi(t)).$r.add(0),[4,mh(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Lf(wf(this._delegate,xf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&vf("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(e,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return e=ml,[4,tf(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Lf(wf(this._delegate,xf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Kl(e);return t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=function(t,e){vi(t).Gr.add(e),e.next()},[4,ef(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return e=function(t,e){vi(t).Gr.delete(e)},[4,ef(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Lf(t=wf(t,xf)),Rf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new ai(si.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new hd(this,Nf(this._delegate,t))}catch(t){throw nd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new ed(this,Df(this._delegate,t))}catch(t){throw nd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new ad(this,function(t,e){if(t=wf(t,_f),df("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ai(si.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Sf(t,null,function(t){return new No(Di.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw nd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,function(t){return Xl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new zl(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Lf(t),(function(n){return e(new zp(t,n))}))}(this._delegate,(function(n){return t(new $p(e,n))}))},t.prototype.batch=function(){var t=this;return Lf(this._delegate),new Zp(new Vp(this._delegate,(function(e){return Kp(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new ai(si.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new ai(si.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Jp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return n(e,t),e.prototype.convertBytes=function(t){return new Wp(new Uf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return ed.Zc(e,this.firestore,null)},e}(Pp),$p=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}return t.prototype.get=function(t){var e=this,n=ld(t);return this._delegate.get(n).then((function(t){return new od(e._firestore,new gp(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))}))},t.prototype.set=function(t,e,n){var r=ld(t);return n?(yf("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=ld(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,c([s,e,n],i)),this},t.prototype.delete=function(t){var e=ld(t);return this._delegate.delete(e),this},t}(),Zp=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=ld(t);return n?(yf("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=ld(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,c([s,e,n],i)),this},t.prototype.delete=function(t){var e=ld(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),td=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new bp(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new sd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Jp(e),n),i.set(n,o)),o},t}();td.eu=new WeakMap;var ed=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new ai(si.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Tf(n._delegate,r,new Ki(e)))},t.Zc=function(e,n,r){return new t(n,new Tf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new hd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new hd(this.firestore,Nf(this._delegate,t))}catch(t){throw nd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=_(t))instanceof Tf&&Cf(this._delegate,t)},t.prototype.set=function(t,e){e=yf("DocumentReference.set",e);try{return function(t,e,n){t=wf(t,Tf);var r=wf(t.firestore,xf),i=Mp(t.converter,e,n);return Kp(r,[Yf(Wf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,as.none())])}(this._delegate,t,e)}catch(t){throw nd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Bp(this._delegate,t):Bp.apply(void 0,c([this._delegate,t,e],n))}catch(t){throw nd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Kp(wf((t=this._delegate).firestore,xf),[new Es(t._key,as.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=rd(e),i=id(e,(function(e){return new od(t.firestore,new gp(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))}));return jp(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=wf(t,Tf);var e=wf(t.firestore,xf),n=Lf(e),r=new qp(e);return function(t,e){var n=this,r=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return o(this,void 0,void 0,(function(){var r,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=vi(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new ai(si.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=jh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,$l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new gp(e,r,t._key,n,new mp(null!==n&&n.hasLocalMutations,!0),t.converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=wf(t,Tf);var e=wf(t.firestore,xf);return nf(Lf(e),t._key,{source:"server"}).then((function(n){return Gp(e,t,n)}))}(this._delegate):function(t){t=wf(t,Tf);var e=wf(t.firestore,xf);return nf(Lf(e),t._key).then((function(n){return Gp(e,t,n)}))}(this._delegate)).then((function(t){return new od(e.firestore,new gp(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(td.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function nd(t,e,n){return t.message=t.message.replace(e,n),t}function rd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Rf(r))return r}return{}}function id(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Rf(t[0])?t[0]:Rf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var od=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new ed(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Ep(this._delegate,t._delegate)},t}(),sd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(od),ad=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Jp(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Sp(this._delegate,function(t,e,n){var r=e,i=vp("where",t);return new Ap(i,r,n)}(e,n,r)))}catch(e){throw nd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Sp(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=vp("orderBy",t);return new Np(r,n)}(e,n)))}catch(e){throw nd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Sp(this._delegate,function(t){return If("limit",t),new Dp("limit",t,"F")}(e)))}catch(e){throw nd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Sp(this._delegate,function(t){return If("limitToLast",t),new Dp("limitToLast",t,"L")}(e)))}catch(e){throw nd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cp("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw nd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cp("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw nd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new kp("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw nd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Sp(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new kp("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw nd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return kf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=wf(t,Sf);var e=wf(t.firestore,xf),n=Lf(e),r=new qp(e);return function(t,e){var n=this,r=new Za;return t.asyncQueue.enqueueAndForget((function(){return o(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return o(this,void 0,void 0,(function(){var r,i,o,a,u;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,Dc(t,e,!0)];case 1:return u=s.sent(),r=new il(e,u.Bn),i=r._o(u.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return a=s.sent(),u=jh(a,"Failed to execute query '"+e+" against cache"),n.reject(u),[3,3];case 3:return[2]}}))}))},[4,$l(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new wp(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=wf(t,Sf);var e=wf(t.firestore,xf),n=Lf(e),r=new qp(e);return rf(n,t._query,{source:"server"}).then((function(n){return new wp(e,r,t,n)}))}(this._delegate):function(t){t=wf(t,Sf);var e=wf(t.firestore,xf),n=Lf(e),r=new qp(e);return _p(t._query),rf(n,t._query).then((function(n){return new wp(e,r,t,n)}))}(this._delegate)).then((function(t){return new cd(e.firestore,new wp(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=rd(e),i=id(e,(function(e){return new cd(t.firestore,new wp(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return jp(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(td.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),ud=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new sd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),cd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new ad(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new sd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new ud(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new sd(n._firestore,r))}))},t.prototype.isEqual=function(t){return Ep(this._delegate,t._delegate)},t}(),hd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return n(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new ed(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ed(this.firestore,void 0===t?Df(this._delegate):Df(this._delegate,t))}catch(t){throw nd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=wf(t.firestore,xf),r=Df(t),i=Mp(t.converter,e);return Kp(n,[Yf(Wf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,as.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new ed(e.firestore,t)}))},e.prototype.isEqual=function(t){return Cf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(td.tu(this.firestore,t)):this._delegate.withConverter(null))},e}(ad);function ld(t){return wf(t,Tf)}var fd,pd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Vf.bind.apply(Vf,c([void 0],t)))}return t.documentId=function(){return new t(ki.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=_(t))instanceof Vf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),dd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new $f("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Xf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Zf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new tp("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new ep("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),yd={Firestore:Xp,GeoPoint:Bf,Timestamp:Ei,Blob:Wp,Transaction:$p,WriteBatch:Zp,DocumentReference:ed,DocumentSnapshot:od,Query:ad,QueryDocumentSnapshot:sd,QuerySnapshot:cd,CollectionReference:hd,FieldPath:pd,FieldValue:dd,setLogLevel:function(t){var e;e=t,ui.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new S("firestore",(function(t){return function(t,e){return new Xp(t,new xf(t,e),new Yp)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},yd)))})(fd=$),fd.registerVersion("@firebase/firestore","2.3.0");const vd={app:$.initializeApp({apiKey:"AIzaSyBhljh7IjGcAOVem5_q9Vmi2e3lvdMX4r4",authDomain:"decript-game.firebaseapp.com",projectId:"decript-game",storageBucket:"decript-game.appspot.com",messagingSenderId:"614410621102",appId:"1:614410621102:web:460506d6f8301f582c9d3f",measurementId:"G-JV4RVZL9TB"}),db:$.firestore()},md=document.getElementById("page1"),gd=document.getElementById("page2-setPW"),bd=document.getElementById("page2-pw"),wd=document.getElementById("onLoading"),Id=document.getElementById("page3"),Ed=vd.db;document.getElementById("checkCode").addEventListener("click",(function(){if(""!==_d.value){if(Nd=_d.value,Ad.getItem(Nd+"TeamTopics")){const t=Ad.getItem(Nd+"TeamTopics").split(","),e=document.getElementsByClassName("topicItem");for(let n=0;n<e.length;n++)e[n].innerText=t[n];return window.alert("登入成功！"),md.style.display="none",void(Id.style.display="block")}if(Ad.getItem(Nd))return window.alert("登入成功!"),md.style.display="none",void(bd.style.display="block");Ed.collection("GameCode").doc(Nd).get().then((t=>{if(t.exists){const e=t.data().pw;window.alert("登入成功！"),md.style.display="none",""===e?gd.style.display="block":(Ad.setItem(Nd,e),bd.style.display="block")}else window.alert("登入失敗！請確認你的遊戲碼");_d.value=""})).catch((t=>{console.log("Error: ",t),window.alert("出現錯誤！請跟開發者聯繫！！"),window.location.reload()}))}else window.alert("請輸入遊戲碼")})),document.getElementById("setPW").addEventListener("click",(function(){if(!Td)return void window.alert("請輸入密碼");const t=Td.value;console.log(Dd);let e=[];for(;e.length<4;)r=Math.floor(Math.random()*Dd.length),e.includes(Dd[r])||e.push(Dd[r]);Ed.collection("GameCode").doc(Nd).set({pw:t,topics:e},{merge:!0}).then((()=>{window.alert("設定成功！"),gd.style.display="none";const n=document.getElementsByClassName("topicItem");for(let t=0;t<n.length;t++)n[t].innerText=e[t];Id.style.display="block",Ad.setItem(Nd+"TeamTopics",e),Ad.setItem(Nd,t)})).catch((t=>{window.alert("出現錯誤: $(error)\n\n請跟開發者聯繫.."),window.location.reload()}))})),document.getElementById("login").addEventListener("click",(function(){if(!Sd)return void window.alert("請輸入密碼");if(Sd.value===Ad.getItem(Nd)){window.alert("登入成功！"),bd.style.display="none";let t=[];Ed.collection("GameCode").doc(Nd).get().then((e=>{e.exists?(t=e.data().topics,Ad.setItem(Nd+"TeamTopics",t)):(window.alert("資料有誤，請洽管理員"),window.location.reload())})).catch((t=>{window.alert("出現錯誤: $(error)\n\n請跟開發者聯繫.."),window.location.reload()})),wd.style.display="block",window.setTimeout((()=>{const e=document.getElementsByClassName("topicItem");for(let n=0;n<e.length;n++)e[n].innerText=t[n];wd.style.display="none",Id.style.display="block"}),2e3)}else window.alert("登入失敗，請確認你的密碼!"),Sd.value=""}));const _d=document.getElementById("gameCode"),Td=document.getElementById("setGamePW"),Sd=document.getElementById("gamePW"),Ad=window.sessionStorage;let Nd="",Dd=[];Ed.collection("GameTopic").get().then((t=>{t.forEach((t=>{Dd.push(t.data().topic)}))}))})();